# TODO: helper scripts
#         fix enable-sdks.sh
#         flatpak-builder like env vars
#         set local installation targets: python, golang, rust
#           node: NPM_PACKAGES=xdg-data/npm-packages
#                 PATH+=:xdg-data/npm-packages/bin
# TODO: add more patched fonts: nerd-fonts
# TODO: investigate broken host tmux sessions
# TODO: still dynamic: chafa, hub, neovide, python app, luajit bindings
# TODO: maybe set dynamic loader to libc.musl-x86_64.so.1 (alpine) when dynamically linking
# TODO: add tarball generation script
# TODO: test portability, needs to work when switching to /var/lib
# TODO: investigate the possiblity to keep extension accessible after update, maybe bindfs mount
# TODO: see other useful tools @ https://github.com/agarrharr/awesome-cli-apps
# TODO: trashcli: set environment variable for trash bin location?

# documentation
#
#   fontconfig
#     add to fonts.conf see flatpaks README.md
#     now: <dir>/usr/lib/sdk/devenv/share/fonts/powerline</dir>
#     next: <dir prefix="xdg">fonts/powerline</dir>
#     see also https://gitlab.freedesktop.org/fontconfig/fontconfig/-/commit/6f27f42e6140030715075aa3bd3e5cc9e2fdc6f1
#
#   easily enable after entering a sandbox
#     add override for envvar
#       `$ flatpak override --user --env=ENABLE_DEVENV=/usr/lib/sdk/devenv/bin/enable-development-environment`
#     enter sandbox and then use envvar to run shell
#       `$ $ENABLE_DEVENV`
#
#   enter a sandbox with enabled shell
#     set envvar in host shell
#       `$ export fpde=/usr/lib/sdk/devenv/bin/enable-development-environment`
#     enter sandbox
#       `$ flatpak run --command=$fpde org.freedesktop.Sdk//21.08`
#
#   enable by default, only works with actual apps, not runtimes
#     add persist override
#       `$ flatpak override --user --persist=. FLATPAK_ID`
#     enter sandbox
#       `$ flatpak run FLATPAK_ID`
#     create .bashrc
#       `$ echo 'source $ENABLE_DEVENV' > .bashrc`
#
#   terminfo: use updated db
#     optional as it's already set by the enable.sh script
#     if added to an app packaging, must use quotes like the example
#     - '--env=TERMINFO_DIRS=/usr/lib/sdk/devenv/share/terminfo:'
#
#   permissions
#     ssh
#       --filesystem=xdg-config/ssh:ro
#       my secret store for storing keys, needed due to symlinks from xdg-config/ssh
#         --filesystem=~/.user/hiddendots/openssh:ro
#       this is the location of my ssh-agent's socket, and likely not needed anymore with new flatpak releases
#         --filesystem=xdg-run/ssh-agent:ro
#       this might be already enabled, it only used by gnome-keyring's agent, and basically bind mounts bind-mounts the xdg-run/ssh-auth
#         --socket=ssh-auth
#       for app/sandbox specific setting, like automatically added known hosts
#         --persist=.ssh
#       only needed with older than flatpak 1.11.1 https://github.com/flatpak/flatpak/commit/0e0e98e7ef0498946d8172ac6d266679434aab6a
#         --env=SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/ssh-agent/sock
#       when using non-default ssh config folder, explictly set IdentityFile
#         Host *
#           IdentityFile ~/.config/ssh/id_rsa
#           IdentityFile ...
#
#     gnupg
#       --filesystem=xdg-config/gnupg:ro
#     code
#       --filesystem=~/projects
#     ccache
#       --filesystem=xdg-cache/ccache
#     byobu
#       --filesystem=xdg-config/byobu/.ssh-agent
#       --filesystem=xdg-run/tmux
#     flatpak-spawn
#       --talk-name=org.freedesktop.Flatpak
#     git
#       --filesystem=xdg-config/git:ro
#     nvim
#       --filesystem=xdg-config/nvim:ro
#       --filesystem=xdg-data/nvim:ro
#     less
#       new less versions don't need a binary lesskey.bin, source default to XDG_CONFIG_HOME/lesskey,
#       only LESSKEYIN envvar needed for host compat
#       --filesystem=xdg-config/lesskey:ro

id: org.freedesktop.Sdk.Extension.devenv
branch: '21.08'
runtime: org.freedesktop.Sdk
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
build-options:
  cflags: -I/usr/lib/sdk/devenv/include
  cxxflags: -I/usr/lib/sdk/devenv/include
  ldflags: -L/usr/lib/sdk/devenv/lib
  prefix: /usr/lib/sdk/devenv
  libdir: /usr/lib/sdk/devenv/lib
  prepend-path: /usr/lib/sdk/devenv/bin
  prepend-ld-library-path: /usr/lib/sdk/devenv/lib
  prepend-pkg-config-path: /usr/lib/sdk/devenv/lib/pkgconfig
  append-path: /usr/lib/sdk/musl/bin
  strip: true
x-musl-static-build-options: &musl-static-build-options
  cflags: -static
  cxxflags: -static
  ldflags: -static
  env:
    - CC=x86_64-linux-musl-gcc
    - CXX=x86_64-linux-musl-g++
x-musl-static-fpic-build-options: &musl-static-fpic-build-options
  cflags: -static -fPIC
  cxxflags: -static -fPIC
  ldflags: -static -fPIC
  env:
    - CC=x86_64-linux-musl-gcc
    - CXX=x86_64-linux-musl-g++
x-musl-shared-build-options: &musl-shared-build-options
  cflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
  cxxflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
  ldflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
  env:
    - CC=x86_64-linux-musl-gcc
    - CXX=x86_64-linux-musl-g++

cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /lib/*.a
  - /share/aclocal
  - /share/cmake
  - /share/doc
  - /share/man/man3
  - /share/man/man5
  - /share/man/man7
  - /share/man/man8
  - '*.la'

modules:

  ############################
  ####     Libraries      ####
  ############################

# - name: musl
#   config-opts:
#     - --libdir=$(prefix)/lib/musl
#     - --includedir=$(prefix)/lib/musl/include
#     - --syslibdir=$(prefix)/lib
#     - --enable-wrapper=all
#     - --disable-shared
#   sources:
#     - type: archive
#       url: https://musl.libc.org/releases/musl-1.2.3.tar.gz
#       sha256: 7d5b0b6062521e4627e099e4c9dc8248d32a30285e959b7eecaa780cf8cfd4a4
#       x-checker-data:
#         type: html
#         url: https://musl.libc.org/
#         version-pattern: musl-([\d\.]+).tar.gz
#         url-template: https://musl.libc.org/releases/musl-$version.tar.gz

  - name: musl-libc-shared
    # TODO: unique loader and lib names, no loader path in shared libs
    buildsystem: simple
    build-commands:
      - install -Dm755 /usr/lib/sdk/musl/x86_64-linux-musl/lib/libc.so -t ${FLATPAK_DEST}/lib/musl
      - ln -s ${FLATPAK_DEST}/lib/musl/libc.so ${FLATPAK_DEST}/lib/ld-musl-x86_64.so.1

  - name: acl-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://download.savannah.gnu.org/releases/acl/acl-2.3.1.tar.gz
        sha256: 760c61c68901b37fdd5eefeeaf4c0c7a26bdfdd8ac747a1edff1ce0e243c11af
        x-checker-data:
          type: anitya
          project-id: 16
          stable-only: true
          url-template: https://download.savannah.gnu.org/releases/acl/acl-$version.tar.gz
    cleanup:
      - '*'
    modules:
      - name: attr-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        sources:
          - type: archive
            url: https://download.savannah.gnu.org/releases/attr/attr-2.5.1.tar.gz
            sha256: bae1c6949b258a0d68001367ce0c741cebdacdd3b62965d17e5eb23cd78adaf8
            x-checker-data:
              type: anitya
              project-id: 137
              stable-only: true
              url-template: https://download.savannah.gnu.org/releases/attr/attr-$version.tar.gz
        cleanup:
          - '*'

  - name: bzip2-static
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz
        sha256: ab5a03176ee106d3f0fa90e381da478ddae405918153cca248e682cd0c4a2269
        x-checker-data:
          type: anitya
          project-id: 237
          stable-only: true
          url-template: https://sourceware.org/pub/bzip2/bzip2-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^CC=/d;/^CFLAGS=/d' Makefile
    cleanup:
      - '*'

  - name: expat-static
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    buildsystem: cmake
    config-opts:
      - -DEXPAT_BUILD_TOOLS=OFF
      - -DEXPAT_BUILD_EXAMPLES=OFF
      - -DEXPAT_BUILD_TESTS=OFF
      - -DEXPAT_SHARED_LIBS=OFF
      - -DEXPAT_BUILD_DOCS=OFF
    sources:
      - type: archive
        url: https://github.com/libexpat/libexpat/releases/download/R_2_4_8/expat-2.4.8.tar.gz
        sha256: 398f6d95bf808d3108e27547b372cb4ac8dc2298a3c4251eb7aa3d4c6d4bb3e2
        x-checker-data:
          type: anitya
          project-id: 770
          stable-only: true
          url-template: https://github.com/libexpat/libexpat/releases/download/R_${version0}_${version1}_${version2}/expat-$version.tar.gz
    cleanup:
      - '*'

  - name: libffi-static
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://github.com/libffi/libffi/releases/download/v3.4.2/libffi-3.4.2.tar.gz
        sha256: 540fb721619a6aba3bdeef7d940d8e9e0e6d2c193595bc243241b77ff9e93620
        x-checker-data:
          type: anitya
          project-id: 1611
          stable-only: true
          url-template: https://github.com/libffi/libffi/releases/download/v$version/libffi-$version.tar.gz
    cleanup:
      - '*'

  - name: libsixel-static
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Dimg2sixel=enabled
      - -Dsixel2png=disabled
      - -Dgdk-pixbuf2=disabled
      - -Dgd=disabled
      - -Dlibcurl=disabled
      - -Djpeg=disabled
      - -Dpng=disabled
    sources:
      - type: archive
        url: https://github.com/libsixel/libsixel/archive/2855eea71effe4d09890f4633f7dd568dbdfae3f/lixsixel-2855eea71effe4d09890f4633f7dd568dbdfae3f.zip
        sha256: 717be779849010e0a9d0d8e1057c4838978857113ce1487086c8204a79edccfa
        x-checker-data:
          type: anitya
          project-id: 243242
          stable-only: true
          versions:
            '>': 1.10.3
          url-template: https://github.com/libsixel/libsixel/archive/v$version/lixsixel-$version.zip
    cleanup:
      - '*'

  - name: lz4-static
    build-options: *musl-static-build-options
    no-autogen: true
    subdir: lib
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/lz4/lz4/archive/fb46a7fe8cd99bb9b8d9fc95d8fa6c238593a740/lz4-fb46a7fe8cd99bb9b8d9fc95d8fa6c238593a740.tar.gz
        sha256: e6d99a8f522f42e1e960d9035c662e009ac09c7857a3eff23e145a2930a1511e
        x-checker-data:
          type: anitya
          project-id: 1865
          stable-only: true
          versions:
            '>': 1.9.3
          url-template: https://github.com/lz4/lz4/archive/v$version/lz4-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^BUILD_SHARED:=/ s/yes/no/' lib/Makefile
    cleanup:
      - '*'

  - name: ncurses-static
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    config-opts:
      - --without-dlsym
      - --with-terminfo-dirs=${datadir}/share/terminfo:/var/lib/devenv/share/terminfo:/usr/share/terminfo
     #- --with-default-terminfo-dir=${datadir}/terminfo
      - --disable-db-install
      - --enable-widec
      - --enable-pc-files
      - --with-normal
      - --with-cxx
      - --with-cxx-binding
      - --without-ada
      - --without-debug
      - --without-manpages
      - --without-progs
      - --without-tests
    post-install:
      - ln -s libncursesw.a ${FLATPAK_DEST}/lib/libcurses.a
      - ln -s libncursesw.a ${FLATPAK_DEST}/lib/libncurses.a
      - ln -s ncursesw.pc ${FLATPAK_DEST}/lib/pkgconfig/tinfo.pc
      - ln -s ncursesw.pc ${FLATPAK_DEST}/lib/pkgconfig/curses.pc
      - ln -s ncursesw.pc ${FLATPAK_DEST}/lib/pkgconfig/ncurses.pc
    sources:
      - type: archive
        url: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz
        sha256: 97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059
        x-checker-data:
          type: anitya
          project-id: 234776
          stable-only: true
          url-template: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$version.tar.gz
      - type: shell
        commands:
          - install -dm755 ${FLATPAK_DEST}/lib/pkgconfig
    cleanup:
      - '*'

  - name: openssl-static
    build-options: *musl-static-build-options
    config-opts:
      - --libdir=lib
      - --openssldir=${FLATPAK_DEST}/ssl
      - -static
      - no-ssl3-method
      - enable-ec_nistp_64_gcc_128
      - linux-x86_64
      - -Wa,--noexecstack
    sources:
      - type: archive
        url: https://www.openssl.org/source/openssl-1.1.1q.tar.gz
        sha256: d7939ce614029cdff0b6c20f0e2e5703158a489a72b2507b8bd51bf8c8fd10ca
        x-checker-data:
          type: anitya
          project-id: 2566
          stable-only: true
          versions:
            <: 2.0.0
          version-scheme: semantic
          url-template: https://www.openssl.org/source/openssl-$version.tar.gz
      - type: patch
        # https://github.com/openssl/openssl/issues/14574
        path: openssl-static-threads.patch
        options:
          - --reverse
      - type: shell
        commands:
          - ln -s {C,c}onfigure
    cleanup:
      - '*'

  - name: popt-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: http://ftp.rpm.org/popt/releases/popt-1.x/popt-1.18.tar.gz
        sha256: 5159bc03a20b28ce363aa96765f37df99ea4d8850b1ece17d1e6ad5c24fdc5d1
        x-checker-data:
          type: anitya
          project-id: 3689
          stable-only: true
          url-template: http://ftp.rpm.org/popt/releases/popt-$version0.x/popt-$version.tar.gz
    cleanup:
      - '*'

  - name: xxhash-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
      - lib
    make-install-args:
      - prefix=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/Cyan4973/xxHash/archive/v0.8.1/xxhash-0.8.1.tar.gz
        sha256: 3bb6b7d6f30c591dd65aaaff1c8b7a5b94d81687998ca9400082c739a690436c
        x-checker-data:
          type: anitya
          project-id: 17583
          stable-only: true
          url-template: https://github.com/Cyan4973/xxHash/archive/v$version/xxhash-$version.tar.gz
      - type: shell
        commands:
          - sed -e '/$(INSTALL_PROGRAM) $(LIBXXH)/d' -e '/ln -sf $(LIBXXH)/d' -i Makefile
    cleanup:
      - '*'

  - name: xz-static
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    config-opts:
      - --disable-shared
      - --disable-xz
      - --disable-xzdec
      - --disable-lzmadec
      - --disable-lzmainfo
      - --disable-lzma-links
      - --disable-scripts
      - --disable-doc
    sources:
      - type: archive
        url: https://tukaani.org/xz/xz-5.2.5.tar.gz
        sha256: f6f4910fd033078738bd82bfba4f49219d03b17eb0794eb91efbae419f4aba10
        x-checker-data:
          type: anitya
          project-id: 5277
          stable-only: true
          url-template: https://tukaani.org/xz/xz-$version.tar.gz
    cleanup:
      - '*'

  - name: zlib-static
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    config-opts:
      - --static
    sources:
      - type: archive
        url: https://zlib.net/zlib-1.2.12.tar.gz
        sha256: 91844808532e5ce316b3c010929493c0244f3d37593afd6de04f71821d5136d9
        x-checker-data:
          type: anitya
          project-id: 5303
          stable-only: true
          url-template: https://zlib.net/zlib-$version.tar.gz
    cleanup:
      - '*'

  - name: zstd-static # depends on lz4 xz zlib
    build-options: *musl-static-build-options
    subdir: build/cmake
    buildsystem: cmake
    config-opts:
      - -DZSTD_BUILD_PROGRAMS=OFF
      - -DZSTD_BUILD_STATIC=ON
      - -DZSTD_BUILD_SHARED=OFF
    sources:
      - type: archive
        url: https://github.com/facebook/zstd/releases/download/v1.5.2/zstd-1.5.2.tar.gz
        sha256: 7c42d56fac126929a6a85dbc73ff1db2411d04f104fae9bdea51305663a83fd0
        x-checker-data:
          type: anitya
          project-id: 12083
          stable-only: true
          url-template: https://github.com/facebook/zstd/releases/download/v$version/zstd-$version.tar.gz
    cleanup:
      - '*'

  - name: readline-static # depends on ncurses
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    config-opts:
      - --disable-shared
      - --with-curses
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/readline/readline-8.1.2.tar.gz
        sha256: 7589a2381a8419e68654a47623ce7dfcb756815c8fee726b98f90bf668af7bc6
        x-checker-data:
          type: anitya
          project-id: 4173
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/readline/readline-$version.tar.gz
      - type: patch
        path: readline-set-devenv-defaults.patch
    cleanup:
      - '*'

  - name: gdbm-static # depends on readline
    # NOTE: python needs -fPIC
    build-options: *musl-static-fpic-build-options
    config-opts:
      - --disable-shared
      - --enable-libgdbm-compat
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gdbm/gdbm-1.23.tar.gz
        sha256: 74b1081d21fff13ae4bd7c16e5d6e504a4c26f7cde1dca0d963a484174bbcacd
        x-checker-data:
          type: anitya
          project-id: 882
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gdbm/gdbm-$version.tar.gz
    cleanup:
      - '*'

  - name: pcre2-static # depends on bzip2 readline zlib
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --enable-pcre2-16
      - --enable-pcre2-32
      - --enable-jit
    post-install:
      - rm ${FLATPAK_DEST}/bin/pcre2{grep,test}
    sources:
      - type: archive
        url: https://github.com/PCRE2Project/pcre2/releases/download/pcre2-10.40/pcre2-10.40.tar.gz
        sha256: ded42661cab30ada2e72ebff9e725e745b4b16ce831993635136f2ef86177724
        x-checker-data:
          type: anitya
          project-id: 5832
          stable-only: true
          url-template: https://github.com/PCRE2Project/pcre2/releases/download/pcre2-$version/pcre2-$version.tar.gz
    cleanup:
      - '*'

  - name: libevent-static  # depends on openssl
    # TODO: try again to build static lib with cmake
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --enable-openssl
    sources:
      - type: archive
        url: https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz
        sha256: 92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb
        x-checker-data:
          type: anitya
          project-id: 1606
          stable-only: true
          url-template: https://github.com/libevent/libevent/releases/download/release-$version-stable/libevent-$version-stable.tar.gz
    cleanup:
      - '*'

  - name: wayland-static # depends on expat liffi
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Dtests=false
      - -Ddocumentation=false
      - -Ddtd_validation=false
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/wayland/wayland/-/releases/1.21.0/downloads/wayland-1.21.0.tar.xz
        sha256: 6dc64d7fc16837a693a51cfdb2e568db538bfdc9f457d4656285bb9594ef11ac
        x-checker-data:
          type: anitya
          project-id: 10061
          stable-only: true
          url-template: https://gitlab.freedesktop.org/wayland/wayland/-/releases/$version/downloads/wayland-$version.tar.xz
    cleanup:
      - '*'

  - name: libxmu-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --disable-docs
      - --disable-unix-transport
      - --disable-tcp-transport
      - --disable-ipv6
      - --disable-local-transport
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/releases/individual/lib/libXmu-1.1.3.tar.bz2
        sha256: 9c343225e7c3dc0904f2122b562278da5fed639b1b5e880d25111561bac5b731
        x-checker-data:
          type: anitya
          project-id: 1785
          stable-only: true
          url-template: https://xorg.freedesktop.org/releases/individual/lib/libXmu-$version.tar.bz2
    cleanup:
      - '*'
    modules:
      - name: xorg-util-macros
        make-install-args:
          - pkgconfigdir=${FLATPAK_DEST}/lib/pkgconfig
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/util/util-macros-1.19.3.tar.gz
            sha256: 624bb6c3a4613d18114a7e3849a3d70f2d7af9dc6eabeaba98060d87e3aef35b
            x-checker-data:
              type: anitya
              project-id: 15037
              stable-only: true
              url-template: https://www.x.org/releases/individual/util/util-macros-$version.tar.gz
        cleanup:
          - '*'
      - name: xorgproto
        post-install:
          - mv ${FLATPAK_DEST}/share/pkgconfig/* ${FLATPAK_DEST}/lib/pkgconfig/
        sources:
          - type: archive
            url: https://xorg.freedesktop.org/archive/individual/proto/xorgproto-2022.1.tar.gz
            sha256: 2a399e77d98fe53e9056726a1934b62cbaa6c41d7b1f41a354911b0925363343
            x-checker-data:
              type: anitya
              project-id: 17190
              stable-only: true
              url-template: https://xorg.freedesktop.org/archive/individual/proto/xorgproto-$version.tar.gz
        cleanup:
          - '*'
      - name: xtrans
        make-install-args:
          - pkgconfigdir=${FLATPAK_DEST}/lib/pkgconfig
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/xtrans-1.4.0.tar.gz
            sha256: 48ed850ce772fef1b44ca23639b0a57e38884045ed2cbb18ab137ef33ec713f9
            x-checker-data:
              type: anitya
              project-id: 13651
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/xtrans-$version.tar.gz
        cleanup:
          - '*'
      - name: libx11-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --disable-specs
          - --disable-unix-transport
          - --disable-tcp-transport
          - --disable-ipv6
          - --disable-local-transport
          - --disable-xf86bigfont
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libX11-1.8.1.tar.gz
            sha256: d52f0a7c02a45449f37b0831d99ff936d92eb4ce8b4c97dc17a63cea79ce5a76
            x-checker-data:
              type: anitya
              project-id: 1764
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libX11-$version.tar.gz
        cleanup:
          - '*'
        modules:
          - name: libxcb-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --enable-xinput
              - --enable-xkb
              - --disable-devel-docs
              - --disable-composite
              - --disable-damage
              - --disable-dpms
              - --disable-dri2
              - --disable-dri3
              - --disable-glx
              - --disable-present
              - --disable-randr
              - --disable-record
              - --disable-render
              - --disable-resource
              - --disable-screensaver
              - --disable-shape
              - --disable-shm
              - --disable-sync
              - --disable-xevie
              - --disable-xfixes
              - --disable-xfree86-dri
              - --disable-xinerama
              - --disable-xtest
              - --disable-xv
              - --disable-xvmc
            sources:
              - type: archive
                url: https://www.x.org/archive/individual/lib/libxcb-1.15.tar.xz
                sha256: cc38744f817cf6814c847e2df37fcb8997357d72fa4bcbc228ae0fe47219a059
                x-checker-data:
                  type: anitya
                  project-id: 1767
                  stable-only: true
                  url-template: https://www.x.org/archive/individual/lib/libxcb-$version.tar.xz
            cleanup:
              - '*'
            modules:
              - name: libxau-static
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                sources:
                  - type: archive
                    url: https://www.x.org/releases/individual/lib/libXau-1.0.9.tar.gz
                    sha256: 1f123d8304b082ad63a9e89376400a3b1d4c29e67e3ea07b3f659cccca690eea
                x-checker-data:
                  type: anitya
                  project-id: 1765
                  stable-only: true
                  url-template: https://www.x.org/releases/individual/lib/libXau-$version.tar.gz
                cleanup:
                  - '*'
              - name: libxdmcp-static
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                sources:
                  - type: archive
                    url: https://www.x.org/releases/individual/lib/libXdmcp-1.1.3.tar.gz
                    sha256: 2ef9653d32e09d1bf1b837d0e0311024979653fe755ad3aaada8db1aa6ea180c
                    x-checker-data:
                      type: anitya
                      project-id: 1772
                      stable-only: true
                      url-template: https://www.x.org/releases/individual/lib/libXdmcp-$version.tar.gz
                cleanup:
                  - '*'
              - name: xcb-proto
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                make-install-args:
                  - pkgconfigdir=${FLATPAK_DEST}/lib/pkgconfig
                sources:
                  - type: archive
                    url: https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-1.15.2.tar.gz
                    sha256: 6b1ed9cd7cf35e37913eeecca37e5b85b14903002942b3e332f321335c27a8eb
                    x-checker-data:
                      type: anitya
                      project-id: 13646
                      stable-only: true
                      url-template: https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-$version.tar.gz
                cleanup:
                  - '*'
      - name: libxext-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libXext-1.3.4.tar.gz
            sha256: 8ef0789f282826661ff40a8eef22430378516ac580167da35cc948be9041aac1
            x-checker-data:
              type: anitya
              project-id: 1774
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libXext-$version.tar.gz
        cleanup:
          - '*'
      - name: libxt-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --disable-specs
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libXt-1.2.1.tar.gz
            sha256: 6da1bfa9dd0ed87430a5ce95b129485086394df308998ebe34d98e378e3dfb33
            x-checker-data:
              type: anitya
              project-id: 1793
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libXt-$version.tar.gz
          - type: shell
            commands:
              - sed -e 's/\(--mode=compile $(CC)\)/\1 -all-static/' -e 's/\(--mode=link
                $(CCLD)\)/\1 -all-static/' -i util/Makefile.in
        cleanup:
          - '*'
        modules:
          - name: libsm-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --disable-docs
              - --disable-unix-transport
              - --disable-tcp-transport
              - --disable-ipv6
              - --disable-local-transport
              - --without-libuuid
            sources:
              - type: archive
                url: https://www.x.org/releases/individual/lib/libSM-1.2.3.tar.gz
                sha256: 1e92408417cb6c6c477a8a6104291001a40b3bb56a4a60608fdd9cd2c5a0f320
            x-checker-data:
              type: anitya
              project-id: 1726
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libSM-$version.tar.gz
            cleanup:
              - '*'
            modules:
              - name: libice-static
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                sources:
                  - type: archive
                    url: https://www.x.org/releases/individual/lib/libICE-1.0.10.tar.gz
                    sha256: 1116bc64c772fd127a0d0c0ffa2833479905e3d3d8197740b3abd5f292f22d2d
                x-checker-data:
                  type: anitya
                  project-id: 1638
                  stable-only: true
                  url-template: https://www.x.org/releases/individual/lib/libICE-$version.tar.gz
                cleanup:
                  - '*'


  ############################
  ####      Python        ####
  ############################

  - name: python
    # TODO: fix gdbm symbol gdbm_version_cmp locating issue
   #build-options: *musl-shared-build-options
    build-options:
      cppflags: -I/usr/lib/sdk/devenv/include -I/usr/lib/sdk/devenv/include/ncursesw
      cflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
      cxxflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
      ldflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
      env:
        - CC=x86_64-linux-musl-gcc
        - CXX=x86_64-linux-musl-g++
    config-opts:
      - --enable-shared
     #- --enable-optimizations
     #- --with-computed-gotos
     #- --with-lto
      - --disable-test-modules
      - --without-doc-strings
      - --with-dbmliborder=gdbm:ndbm
      - --with-system-expat
      - --with-system-ffi
      # TODO: add libmpdec lib?
     #- --with-system-libmpdec
    sources:
      - type: archive
        url: https://www.python.org/ftp/python/3.10.5/Python-3.10.5.tar.xz
        sha256: 8437efd5b106ef0a75aabfbf23d880625120a73a86a22ade4d2e2e68d7b74486
        x-checker-data:
          type: anitya
          project-id: 13254
          stable-only: true
          url-template: https://www.python.org/ftp/python/$version/Python-$version.tar.xz
      - type: shell
        commands:
          - sed 's|/usr/include|${prefix}/include|' -i configure
          - rm -r Modules/expat
          - rm -r Modules/_ctypes/{darwin,libffi}*
         #- rm -r Modules/_decimal/libmpdec
          - rm ${FLATPAK_DEST}/lib/libgdbm.a
    cleanup:
      - '*'

  - name: python-wheel
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links=file://$PWD --prefix=$FLATPAK_DEST
        wheel --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c0/6c/9f840c2e55b67b90745af06a540964b73589256cb10cc10057c87ac78fc2/wheel-0.37.1.tar.gz
        sha256: e9a504e793efbca1b8e0e9cb979a249cf4a0a7b5b8c9e8b65a5e39d49529c1c4
        x-checker-data:
          type: pypi
          name: wheel
    cleanup:
      - '*'

  - name: pyenv
    buildsystem: simple
    build-commands:
      - install -dm755 ${FLATPAK_DEST}/share/pyenv
      - cp -a libexec plugins pyenv.d ${FLATPAK_DEST}/share/pyenv/
      - ln -sr ${FLATPAK_DEST}/share/pyenv/{libexec/pyenv,plugins/python-build/bin/*}
        -t ${FLATPAK_DEST}/bin/
      - install -Dm644 completions/pyenv.bash ${FLATPAK_DEST}/share/bash-completion/completions/pyenv
      - install -Dm644 completions/pyenv.fish -t ${FLATPAK_DEST}/share/fish/vendor_completions.d/
      - install -Dm644 completions/pyenv.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_pyenv
      - install -Dm644 man/man1/pyenv.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/pyenv/pyenv/archive/v2.3.2/pyenv-2.3.2.tar.gz
        sha256: 150ac8f7161c00e8e613bf5e273306f674b60037e3dace9c6bb7611dceb17144
        x-checker-data:
          type: json
          url: https://api.github.com/repos/pyenv/pyenv/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/pyenv/pyenv/archive/v" + $version + "/pyenv-"
            + $version + ".tar.gz"'
    cleanup:
      - /share/pyenv/pyenv.d/install
      - /share/pyenv/plugins/python-build/scripts
      - /share/pyenv/plugins/python-build/test
      - .gitignore
      - LICENSE
      - README.md
      - install.sh

  - name: pyinstaller
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands:
      - ln -s ${FLATPAK_DEST}/lib/musl/libc.so ${FLATPAK_DEST}/bin/ldd
     #- |
     #  cd bootloader
     #  ./waf all
      - python3 setup.py build
      - python3 setup.py install --skip-build --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://github.com/pyinstaller/pyinstaller/archive/v5.2/pyinstaller-5.2.tar.gz
        sha256: f48a29ef9b12a5b4bb1b8f37a33f38cdc034869c946425d5b4217d97a42beaa7
        x-checker-data:
          type: anitya
          project-id: 122995
          stable-only: true
          url-template: https://github.com/pyinstaller/pyinstaller/archive/v$version/pyinstaller-$version.tar.gz
    cleanup:
      - '*'

  - name: pyinstaller-hooks-contrib
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --skip-build --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://github.com/pyinstaller/pyinstaller-hooks-contrib/archive/2022.8/pyinstaller-hooks-contrib-2022.8.tar.gz
        sha256: 8b90f6b26959016ea38b5d0bac81b966888b3a30cb1069128d255c91de27e47d
        x-checker-data:
          type: anitya
          project-id: 91839
          stable-only: true
          url-template: https://github.com/pyinstaller/pyinstaller-hooks-contrib/archive/$version/pyinstaller-hooks-contrib-$version.tar.gz
    cleanup:
      - '*'

  - name: altgraph
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links=file://$PWD --prefix=$FLATPAK_DEST
        altgraph --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/84/3f/1a5c9bef54cac9bf41edd6f4aaf61cd52ed578e10ccc607e0278012cb4a5/altgraph-0.17.2-py2.py3-none-any.whl
        sha256: 743628f2ac6a7c26f5d9223c91ed8ecbba535f506f4b6f558885a8a56a105857
        x-checker-data:
          type: pypi
          name: altgraph
          packagetype: bdist_wheel
    cleanup:
      - '*'

# - name: pyoxidizer
#   buildsystem: simple
#   build-commands:
#     - install -Dm755 pyoxidizer ${FLATPAK_DEST}/bin/
#   sources:
#     - type: archive
#       url: https://github.com/indygreg/PyOxidizer/releases/download/pyoxidizer%2F0.22.0/pyoxidizer-0.22.0-x86_64-unknown-linux-musl.tar.gz
#       sha256: be8fb5d28a3b2405ed672b711199f6dad41b1293551a9023866b2f082e6decc6
#       x-checker-data:
#         type: anitya
#         project-id: 198997
#         stable-only: true
#         url-template: https://github.com/indygreg/PyOxidizer/releases/download/pyoxidizer%2F0.22.0/pyoxidizer-${version}-x86_64-unknown-linux-musl.tar.gz

  ############################
  ####       Shell        ####
  ############################

  - name: bash-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static-link
      - --enable-readline
      - --disable-nls
      - --with-curses
      - --with-installed-readline
      - --without-bash-malloc
    make-args:
      - TERMCAP_LIB=-lncursesw
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/bash/bash-5.1.16.tar.gz
        sha256: 5bac17218d3911834520dad13cd1f85ab944e1c09ae1aba55906be1f8192f558
        x-checker-data:
          type: anitya
          project-id: 166
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/bash/bash-$version.tar.gz
      - type: patch
        path: bash-config-top.h-set-devenv-defaults.patch
      - type: patch
        path: bash-add-localstatedir-bashrc-support.patch
      - type: shell
        commands:
          # never build these libs
          - rm -r lib/{readline,termcap}/*.c
    cleanup:
      - /share/info

  - name: bash-completion
    sources:
      - type: archive
        url: https://github.com/scop/bash-completion/releases/download/2.11/bash-completion-2.11.tar.xz
        sha256: 73a8894bad94dee83ab468fa09f628daffd567e8bef1a24277f1e9a0daf911ac
        x-checker-data:
          type: anitya
          project-id: 5667
          stable-only: true
          url-template: https://github.com/scop/bash-completion/releases/download/$version/bash-completion-$version.tar.xz
      - type: shell
        commands:
          - sed -i '/^pkgconfigdir.*=/ s/datadir/libdir/' Makefile.in

  - name: bash-complete-alias
    buildsystem: simple
    build-commands:
      - install -Dm644 complete_alias -t ${FLATPAK_DEST}/share/bash-complete-alias/
    sources:
      - type: archive
        url: https://github.com/cykerway/complete-alias/archive/1.18.0/complete-alias-1.18.0.tar.gz
        sha256: c34b85c2729650415d97280afeeed6aa29a9e318a8a39061722493cacb927445
        x-checker-data:
          type: anitya
          project-id: 267535
          stable-only: true
          url-template: https://github.com/cykerway/complete-alias/archive/$version/complete-alias-$version.tar.gz

  - name: fish
    build-options: *musl-static-build-options
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -Wno-dev
      - -DWITH_GETTEXT=OFF
      - -DSYS_PCRE2_INCLUDE_DIR=/usr/lib/sdk/devenv/include
      - -DSYS_PCRE2_LIB=/usr/lib/sdk/devenv/lib/libpcre2-32.a
      - -DNCURSES_INCLUDE_DIRS=/usr/lib/sdk/devenv/include/ncursesw
      - -DTPARM_INCLUDES=/usr/lib/sdk/devenv/include/ncursesw/term.h
      - -DNCURSES_LIBRARY=/usr/lib/sdk/devenv/lib/libncursesw.a
      - -DCURSES_TINFO=/usr/lib/sdk/devenv/lib/libncursesw.a
      - -DCMAKE_CXX_FLAGS=-DHAVE_NCURSES_H -DHAVE_TERM_H
      - -DTPUTS_USES_INT_ARG=1
    sources:
      - type: archive
        url: https://github.com/fish-shell/fish-shell/releases/download/3.5.1/fish-3.5.1.tar.xz
        sha256: a6d45b3dc5a45dd31772e7f8dfdfecabc063986e8f67d60bd7ca60cc81db6928
        x-checker-data:
          type: anitya
          project-id: 815
          stable-only: true
          url-template: https://github.com/fish-shell/fish-shell/releases/download/$version/fish-$version.tar.xz
      - type: shell
        commands:
          - sed -i '/Fish does not support static linking/ s/FATAL_ERROR/WARNING/'
            CMakeLists.txt
    cleanup:
      - /etc
      - /share/applications
      - /share/pixmaps

  - name: zsh-static
    build-options: *musl-static-build-options
    config-opts:
      # TODO: edit config.modules to compile modules
      # sed_i 's/link=no/link=static/' config.modules
      - --enable-libc-musl
      - --disable-dynamic
      - --docdir=${FLATPAK_DEST}/share/doc/zsh
      - --htmldir=${FLATPAK_DEST}/share/doc/zsh/html
      - --enable-etcdir=${FLATPAK_DEST}/etc/zsh
      - --enable-zshenv=${FLATPAK_DEST}/etc/zsh/zshenv
      - --enable-zlogin=${FLATPAK_DEST}/etc/zsh/zlogin
      - --enable-zlogout=${FLATPAK_DEST}/etc/zsh/zlogout
      - --enable-zprofile=${FLATPAK_DEST}/etc/zsh/zprofile
      - --enable-zshrc=${FLATPAK_DEST}/etc/zsh/zshrc
      - --enable-maildir-support
      - --enable-multibyte
      - --enable-function-subdirs
      - --enable-fndir=${FLATPAK_DEST}/share/zsh/functions
      - --enable-scriptdir=${FLATPAK_DEST}/share/zsh/scripts
      - --with-tcsetpgrp
#     - --enable-pcre
#     - --enable-cap
#     - --enable-zsh-secure-free
    post-install:
     # unneeded filesystem (mv) operations on ${FLATPAK_DEST}/bin/zsh breaks rofiles, overwriting the file fix this
      - install -Dm755 ${FLATPAK_DEST}/bin/zsh{-*,}
    sources:
      - type: archive
        url: https://www.zsh.org/pub/zsh-5.9.tar.xz
        sha256: 9b8d1ecedd5b5e81fbf1918e876752a7dd948e05c1a0dba10ab863842d45acd5
        x-checker-data:
          type: anitya
          project-id: 5307
          stable-only: true
          url-template: https://www.zsh.org/pub/zsh-$version.tar.xz
    modules:
      - name: libcap-static
        build-options: *musl-static-build-options
        no-autogen: true
        subdir: libcap
        make-args:
          - SHARED=no
          - prefix=${FLATPAK_DEST}
          - lib=lib
        make-install-args:
          - SHARED=no
          - prefix=${FLATPAK_DEST}
          - lib=lib
        sources:
          - type: archive
            url: https://kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-2.65.tar.xz
            sha256: 73e350020cc31fe15360879d19384ffa3395a825f065fcf6bda3a5cdf965bebd
            x-checker-data:
              type: anitya
              project-id: 1569
              stable-only: true
              url-template: https://kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-$version.tar.xz

  - name: powerline-fonts
    # TODO: generate updated patched fonts with https://github.com/powerline/fontpatcher
    buildsystem: simple
    build-commands:
      # fc-match: Noto Mono for Powerline
      - install -Dm644 NotoMono/Noto\ Mono\ for\ Powerline.ttf ${FLATPAK_DEST}/share/fonts/powerline/NotoSansMonoPowerline.ttf
    sources:
      - type: archive
        url: https://github.com/powerline/fonts/archive/4622ed562eb077e502524c8a1add6d5454a057b7/powerline-4622ed562eb077e502524c8a1add6d5454a057b7.tar.gz
        sha256: 7f98d7e313d44f49c7637ce43469918cf6ba1fae1398ff5603392f7d2bc916c0
        x-checker-data:
          type: json
          url: https://api.github.com/repos/powerline/fonts/commits?sha=master&path=NotoMono&per_page=1
          version-query: .[].sha
          timestamp-query: .[].commit.committer.date
          url-query: '"https://github.com/powerline/fonts/archive/" + $version + "/powerline-"
            + $version + ".tar.gz"'

  - name: powerline-go
    buildsystem: simple
    build-commands:
      - install -Dm755 powerline-go -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: powerline-go
        url: https://github.com/justjanne/powerline-go/releases/download/v1.22.1/powerline-go-linux-amd64
        sha256: 1cdd4fdb5dea23fc25d59e4cc845960c60bf8ead0e9b004351ee3479d805ecb4
        x-checker-data:
          type: anitya
          project-id: 16076
          stable-only: true
          url-template: https://github.com/justjanne/powerline-go/releases/download/v$version/powerline-go-linux-amd64

  ############################
  ####      Terminal      ####
  ############################

  - name: terminfo-db
    config-opts:
      - --bindir=/var/bin
      - --includedir=/var/include
      - --libdir=/var/lib
      - --enable-db-install
      - --without-ada
      - --without-curses-h
      - --without-cxx
      - --without-cxx-binding
      - --without-debug
      - --without-manpages
      - --without-normal
      - --without-progs
      - --without-tests
    make-install-args:
      - tabsetdir=/var/share/tabset
    sources:
      - type: archive
        url: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz
        sha256: 97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059
        x-checker-data:
          type: anitya
          project-id: 234776
          stable-only: true
          url-template: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$version.tar.gz

# - name: foot
#   buildsystem: meson
#   sources:
#     - type: archive
#       url: https://codeberg.org/dnkl/foot/archive/1.12.1.tar.gz
#       sha256: 14e307ac89454b682bb9f1bc644043779f4462df656034fcc4c1e72b18fbffdd
#       x-checker-data:
#         type: anitya
#         project-id: 141611
#         stable-only: true
#         url-template: https://codeberg.org/dnkl/foot/archive/$version.tar.gz
#   modules:
#     - name: tllist
#       buildsystem: meson
#       sources:
#         - type: archive
#           url: https://codeberg.org/dnkl/tllist/archive/1.0.5.tar.gz
#           sha256: b0f32c9b2c2015c8d8dd068fd4e8b586aa91ca1670badc274ec962559ee0aadd
#           x-checker-data:
#             type: anitya
#             project-id: 141661
#             stable-only: true
#             url-template: https://codeberg.org/dnkl/tllist/archive/$version.tar.gz
#       cleanup:
#         - '*'
#     - name: fcft
#       buildsystem: meson
#       sources:
#         - type: archive
#           url: https://codeberg.org/dnkl/fcft/archive/3.1.2.tar.gz
#           sha256: f571afe693d3fa11fe36e97c7a2ecbbf9313755ee31c1ec3dcc648796b8e6db0
#           x-checker-data:
#             type: anitya
#             project-id: 143240
#             stable-only: true
#             url-template: https://codeberg.org/dnkl/fcft/archive/$version.tar.gz


  ############################
  ####    Multiplexer     ####
  ############################

  # TODO: add mosh, tmate, screen
  - name: byobu
    sources:
      - type: archive
        url: https://launchpad.net/byobu/trunk/5.133/+download/byobu_5.133.orig.tar.gz
        sha256: 4d8ea48f8c059e56f7174df89b04a08c32286bae5a21562c5c6f61be6dab7563
        x-checker-data:
          type: anitya
          project-id: 236
          stable-only: true
          url-template: https://launchpad.net/byobu/trunk/$version/+download/byobu_$version.orig.tar.gz
      - type: shell
        commands:
          - sed -i 's#^\(SOCKETDIR\)=.*#\1=/tmp/screens#' etc/byobu/socketdir
    cleanup:
      - /share/byobu/desktop
      - /share/byobu/pixmaps
      - /share/dbus-1
    modules:
      - name: libnewt-static
        build-options: *musl-static-build-options
        sources:
          - type: archive
            url: https://releases.pagure.org/newt/newt-0.52.21.tar.gz
            sha256: 265eb46b55d7eaeb887fca7a1d51fe115658882dfe148164b6c49fccac5abb31
            x-checker-data:
              type: anitya
              project-id: 15129
              stable-only: true
              url-template: https://releases.pagure.org/newt/newt-$version.tar.gz
          - type: shell
            commands:
              - sed -e '/^whiptail:/ s/LIBNEWTSH/LIBNEWT/' -e '/^all:/ s/_snack.$(SOEXT)//'
                -e '/^install:/ s/install-sh//' -i Makefile.in
        cleanup:
          - /share/locale
        modules:
          - name: libxcrypt-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --disable-failure-tokens
              - --enable-hashes=strong,glibc
              - --enable-obsolete-api=no
            sources:
              - type: archive
                url: https://github.com/besser82/libxcrypt/archive/v4.4.28.tar.gz
                sha256: db7e37901969cb1d1e8020cb73a991ef81e48e31ea5b76a101862c806426b457
                x-checker-data:
                  type: anitya
                  project-id: 16436
                  stable-only: true
                  url-template: https://github.com/besser82/libxcrypt/archive/v$version.tar.gz
            cleanup:
              - '*'
          - name: gpm-static
            build-options: *musl-static-build-options
            config-opts:
              - --enable-static
              - --sbindir=${prefix}/bin
              - --sysconfdir=${prefix}/etc
            post-install:
              - rm ${FLATPAK_DEST}/lib/libgpm.so*
            sources:
              - type: archive
                url: https://github.com/telmich/gpm/archive/e82d1a653ca94aa4ed12441424da6ce780b1e530/gpm-e82d1a653ca94aa4ed12441424da6ce780b1e530.tar.gz
                sha256: 570e6fcf0d9312f76aad7edfa8fc8bf90ae714ebe5ee444faece7ed7bf270939
                x-checker-data:
                  type: json
                  url: https://api.github.com/repos/telmich/gpm/commits?sha=master&per_page=1
                  version-query: .[].sha
                  timestamp-query: .[].commit.committer.date
                  url-query: '"https://github.com/telmich/gpm/archive/" + $version
                    + "/gpm-" + $version + ".tar.gz"'
              - type: shell
                commands:
                  - sed -e '\|prog/gpm-root| s/libgpm.so.@abi_lev@/libgpm.a/' -e '\|$(PROG)|
                    s/libgpm.so.@abi_lev@/libgpm.a/' -e '\|$(LIBS) lib/libgpm.so.@abi_lev@|
                    s/libgpm.so.@abi_lev@/libgpm.a/' -e '\|^all:| s/libgpm.so//' -e
                    '\|$(CC) @LDFLAGS@| s/\($(CC)\)/\1 @CFLAGS@ $(CFLAGS)/' -i src/Makefile.in
            cleanup:
              - /share/info
          - name: slang-static
            build-options: *musl-static-build-options
            no-parallel-make: true
            no-make-install: true
            config-opts:
              - --with-pcreinc=/usr/include
              - --with-pcrelib=/usr/lib/x86_64-linux-gnu
            make-args:
              - static
            build-commands:
              - make install-static
            sources:
              - type: archive
                url: https://www.jedsoft.org/releases/slang/slang-2.3.2.tar.bz2
                sha256: fc9e3b0fc4f67c3c1f6d43c90c16a5c42d117b8e28457c5b46831b8b5d3ae31a
                x-checker-data:
                  type: anitya
                  project-id: 4829
                  stable-only: true
                  url-template: https://www.jedsoft.org/releases/slang/slang-$version.tar.bz2
            cleanup:
              - '*'

  - name: tmux-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
      - --enable-utempter
    sources:
      - type: archive
        url: https://github.com/tmux/tmux/releases/download/3.3a/tmux-3.3a.tar.gz
        sha256: e4fd347843bd0772c4f48d6dde625b0b109b7a380ff15db21e97c11a4dcdf93f
        x-checker-data:
          type: anitya
          project-id: 4980
          stable-only: true
          url-template: https://github.com/tmux/tmux/releases/download/$version/tmux-$version.tar.gz
    modules:
      - name: libutempter-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - libdir=${FLATPAK_DEST}/lib
          - libexecdir=${FLATPAK_DEST}/lib
          - includedir=${FLATPAK_DEST}/include
          - mandir=${FLATPAK_DEST}/share/man
        sources:
          - type: archive
            url: http://ftp.altlinux.org/pub/people/ldv/utempter/libutempter-1.2.1.tar.gz
            sha256: 967fef372f391de501843ad87570c6cf5dabd9651f00f1783090fbc12b2a34cb
            x-checker-data:
              type: anitya
              project-id: 1751
              stable-only: true
              url-template: http://ftp.altlinux.org/pub/people/ldv/utempter/libutempter-$version.tar.gz
          - type: shell
            commands:
              - sed -e '/^TARGETS/ s/$(SHAREDLIB)//' -e '/$(INSTALL).*$(SHAREDLIB)/d'
                -e '/ln -s.*$(SHAREDLIB)/d' -e '/$(LINK.c)/ s/COMPILE_PIE/COMPILE_PIC/'
                -e '/$(LINK.c)/ s/LINK_PIE/LINK_PIC/' -i Makefile


  ############################
  ####     Data format    ####
  ############################

  - name: jq-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-all-static
    sources:
      - type: archive
        url: https://github.com/stedolan/jq/releases/download/jq-1.6/jq-1.6.tar.gz
        sha256: 5de8c8e29aaa3fb9cc6b47bb27299f271354ebb72514e3accadc7d38b5bbaa72
        x-checker-data:
          type: anitya
          project-id: 13252
          stable-only: true
          url-template: https://github.com/stedolan/jq/releases/download/jq-$version/jq-$version.tar.gz
    modules:
      - name: oniguruma-static
        build-options: *musl-static-build-options
        config-opts:
          - --enable-posix-api
        sources:
          - type: archive
            url: https://github.com/kkos/oniguruma/releases/download/v6.9.8/onig-6.9.8.tar.gz
            sha256: 28cd62c1464623c7910565fb1ccaaa0104b2fe8b12bcd646e81f73b47535213e
            x-checker-data:
              type: anitya
              project-id: 11184
              stable-only: true
              url-template: https://github.com/kkos/oniguruma/releases/download/v$version/onig-$version.tar.gz

  - name: go-yq
    buildsystem: simple
    build-commands:
      - install -Dm755 yq -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: yq
        url: https://github.com/mikefarah/yq/releases/download/v4.26.1/yq_linux_amd64
        sha256: 9e35b817e7cdc358c1fcd8498f3872db169c3303b61645cc1faf972990f37582
        x-checker-data:
          type: json
          url: https://api.github.com/repos/mikefarah/yq/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/mikefarah/yq/releases/download/v" + $version
            + "/yq_linux_amd64"'


  ############################
  ####      Editors       ####
  ############################

  # TODO: add imhex
  # TODO: add tui hex editor, bbe?
  # TODO: add micro? amp?
  - name: neovim-static
    build-options: *musl-static-build-options
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      # wrong detection of msgpack set this to /usr/include
      - -DMSGPACK_INCLUDE_DIRS=/usr/lib/sdk/devenv/include
      - -DENABLE_LIBINTL=OFF
      - -DENABLE_LIBICONV=OFF
    buildsystem: cmake-ninja
    builddir: true
    cleanup:
      - /share/applications
      - /share/icons
      - /share/pixmaps
    sources:
      - type: archive
        url: https://github.com/neovim/neovim/archive/v0.7.2/neovim-0.7.2.tar.gz
        sha256: ccab8ca02a0c292de9ea14b39f84f90b635a69282de38a6b4ccc8565bc65d096
        x-checker-data:
          type: anitya
          project-id: 9037
          stable-only: true
          url-template: https://github.com/neovim/neovim/archive/v$version/neovim-$version.tar.gz
      - type: shell
        commands:
          # detection of runtime libs adds -I/usr/include before toolchain headers
          - sed -i '/^include_directories.*config/i include_directories("/usr/lib/sdk/musl/x86_64-linux-musl/include")'
            CMakeLists.txt
    modules:
      - name: libluv-static
        build-options: *musl-static-build-options
        buildsystem: cmake-ninja
        config-opts:
          - -DBUILD_MODULE=OFF
          - -DBUILD_STATIC_LIBS=ON
          - -DLUA_BUILD_TYPE=System
        sources:
          - type: archive
            url: https://github.com/luvit/luv/releases/download/1.44.2-0/luv-1.44.2-0.tar.gz
            sha256: 30639f8e0fac7fb0c3a04b94a00f73c6d218c15765347ceb0998a6b72464b6cf
            x-checker-data:
              type: anitya
              project-id: 21510
              stable-only: true
              url-template: https://github.com/luvit/luv/releases/download/$version/luv-$version.tar.gz
        modules:
          - name: libuv-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
            sources:
              - type: archive
                url: https://github.com/libuv/libuv/archive/v1.44.2/libuv-1.44.2.tar.gz
                sha256: e6e2ba8b4c349a4182a33370bb9be5e23c51b32efb9b9e209d0e8556b73a48da
                x-checker-data:
                  type: anitya
                  project-id: 10784
                  stable-only: true
                  url-template: https://github.com/libuv/libuv/archive/v$version/libuv-$version.tar.gz
          - name: luajit
            build-options: *musl-shared-build-options
            no-autogen: true
            make-args:
              - PREFIX=${FLATPAK_DEST}
              - HOST_XCFLAGS=-static -I.
            make-install-args:
              - PREFIX=${FLATPAK_DEST}
            post-install:
              - ln -s luajit-2.1.0-beta3 ${FLATPAK_DEST}/bin/luajit
              - rm ${FLATPAK_DEST}/lib/libluajit-*.so*
            sources:
              - type: archive
                url: https://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz
                sha256: 1ad2e34b111c802f9d0cdf019e986909123237a28c746b21295b63c9e785d9c3
                x-checker-data:
                  type: anitya
                  project-id: 6444
                  stable-only: true
                  versions:
                    '>': 2.0.5
                  url-template: https://luajit.org/download/LuaJIT-$version.tar.gz
              - type: shell
                commands:
                  - sed -e '/^CC=/d' -i src/Makefile
            cleanup:
              - /bin
      - name: libtermkey-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
        sources:
          - type: archive
            url: http://www.leonerd.org.uk/code/libtermkey/libtermkey-0.22.tar.gz
            sha256: 6945bd3c4aaa83da83d80a045c5563da4edd7d0374c62c0d35aec09eb3014600
            x-checker-data:
              type: anitya
              project-id: 230179
              stable-only: true
              url-template: http://www.leonerd.org.uk/code/libtermkey/libtermkey-$version.tar.gz
          - type: shell
            commands:
              - sed -e '/$(LIBTOOL)/ s/\($(CC)\)/\1 $(CFLAGS)/' -e '/^all:/ s/$(DEMOS)//'
                -i Makefile
        modules:
          - name: unibilium-static
            build-options: *musl-static-build-options
            no-autogen: true
            make-install-args:
              - PREFIX=${FLATPAK_DEST}
            sources:
              - type: archive
                url: https://github.com/neovim/unibilium/archive/v2.1.1/unibilium-2.1.1.tar.gz
                sha256: 6f0ee21c8605340cfbb458cbd195b4d074e6d16dd0c0e12f2627ca773f3cabf1
                x-checker-data:
                  type: anitya
                  project-id: 11136
                  stable-only: true
                  url-template: https://github.com/neovim/unibilium/archive/v$version/unibilium-$version.tar.gz
      - name: lua-lpeg
        # TODO: clean this
        build-options: *musl-static-build-options
       #build-options: *musl-shared-build-options
        buildsystem: simple
        build-commands:
          - |
            #x86_64-linux-musl-ld --help
            #exit 1
             files=(lpcap lpcode lpprint lptree lpvm)
             for f in ${files[@]};do
               ${CC} -c -fPIC -I${FLATPAK_DEST}/include/luajit-2.1/ ${f}.c -o ${f}.o
              #${CC} -c -I${FLATPAK_DEST}/include/luajit-2.1/ ${f}.c -o ${f}.o -Wl,-Bstatic,-nostartfiles,-L${FLATPAK_DEST}/lib,-L/usr/lib/sdk/musl/x86_64-linux-musl/lib -lluajit-5.1 -Wl,-Bdynamic
             done
          - x86_64-linux-musl-ar -crs lpeg.a lpcap.o lpcode.o lpprint.o lptree.o lpvm.o
          - ${CC} -shared -o lpeg.so -Wl,--whole-archive lpeg.a -L${FLATPAK_DEST}/lib/libluajit-5.1.so
            -Wl,--no-whole-archive
          - install -Dm755 lpeg.so -t ${FLATPAK_DEST}/lib/lua/5.1/
          - install -Dm644 re.lua -t ${FLATPAK_DEST}/share/lua/5.1/
         #- ${CC} -shared -o test.so -Wl,--whole-archive lpeg.a -L${FLATPAK_DEST}/lib/libluajit-5.1.so -Wl,--no-whole-archive
         #- x86_64-inux-musl-ar -crs lpeg.a lpcap.o lpcode.o lpprint.o lptree.o lpvm.o
         #- ${CC} -shared -o test.so -Wl,--whole-archive lpeg.a -L${FLATPAK_DEST}/lib/libluajit-5.1.so -Wl,--no-whole-archive
       #no-autogen: true
       #no-make-install: true
       #make-args:
       #  - LUADIR=${FLATPAK_DEST}/include/luajit-2.1/
       #  - lpeg.so
       #post-install:
       #  - exit 1
       #  - install -Dm755 -t ${FLATPAK_DEST}/lib/lua/5.1/ lpeg.so
       #  - install -Dm644 -t ${FLATPAK_DEST}/share/lua/5.1/ re.lua
        sources:
          - type: archive
            url: http://www.inf.puc-rio.br/~roberto/lpeg/lpeg-1.0.2.tar.gz
            sha256: 48d66576051b6c78388faad09b70493093264588fcd0f258ddaab1cdd4a15ffe
            x-checker-data:
              type: anitya
              project-id: 1852
              stable-only: true
              url-template: http://www.inf.puc-rio.br/~roberto/lpeg/lpeg-$version.tar.gz
         #- type: shell
         #  commands:
         #    - sed -e '/^CC/d' -i makefile
         #    - sed -i 's|-shared|-static|' makefile
         #    - sed -i 's|-o lpeg.so| -Wl,-nostartfiles -L/usr/lib/sdk/devenv/lib/libluajit-5.1.so -o lpeg.so|' makefile
         #    - sed -i 's|env ||' makefile
         #    - sed -i 's|$(CC) $(DLLFLAGS)|$(CC) $(CFLAGS) $(DLLFLAGS)|' makefile
         #    - sed -i 's|^CFLAGS.*|CFLAGS:=$(CFLAGS) -fPIC -I$(LUADIR)|' makefile
        cleanup:
          - '*'
      - name: lua-mpack
        build-options: *musl-shared-build-options
        no-autogen: true
        make-args:
          - USE_SYSTEM_MPACK=yes
          - LUA_INCLUDE=-I${FLATPAK_DEST}/include/luajit-2.1/
        make-install-args:
          - USE_SYSTEM_MPACK=yes
        sources:
          - type: archive
            url: https://github.com/libmpack/libmpack-lua/archive/1.0.9/libmpack-lua-1.0.9.tar.gz
            sha256: e94d5cf95d7479dca00ff23755fe05a440f11f9d203635e862ad8842de95f40a
            x-checker-data:
              type: anitya
              project-id: 12613
              stable-only: true
              url-template: https://github.com/libmpack/libmpack-lua/archive/$version/libmpack-lua-$version.tar.gz
          - type: shell
            commands:
              - sed -i 's|/usr/lib|'${FLATPAK_DEST}'/lib|' Makefile
             #- sed -i 's|-shared|-static|' Makefile
              - sed -i 's|\($(LIBS)\)$|\1 -nostartfiles -lluajit-5.1 -lc|' Makefile
        cleanup:
          - '*'
        modules:
          - name: mpack-static
            # NOTE: lua-mpack needs -fPIC
            build-options: *musl-static-fpic-build-options
            no-autogen: true
            make-install-args:
              - PREFIX=${FLATPAK_DEST}
            sources:
              - type: archive
                url: https://github.com/libmpack/libmpack/archive/1.0.5/libmpack-1.0.5.tar.gz
                sha256: 4ce91395d81ccea97d3ad4cb962f8540d166e59d3e2ddce8a22979b49f108956
                x-checker-data:
                  type: anitya
                  project-id: 12423
                  stable-only: true
                  url-template: https://github.com/libmpack/libmpack/archive/$version/libmpack-$version.tar.gz
              - type: shell
                commands:
                  - mkdir -p build/debug/{src,test{,/deps/tap}}
            cleanup:
              - '*'
      - name: libvterm-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
        sources:
          - type: archive
            url: https://www.leonerd.org.uk/code/libvterm/libvterm-0.1.4.tar.gz
            sha256: bc70349e95559c667672fc8c55b9527d9db9ada0fb80a3beda533418d782d3dd
            x-checker-data:
              type: anitya
              project-id: 267537
              stable-only: true
              url-template: https://www.leonerd.org.uk/code/libvterm/libvterm-$version.tar.gz
              versions:
                <: '0.2'
        cleanup:
          - /bin
      - name: msgpack-c-static
        build-options: *musl-static-build-options
        buildsystem: cmake-ninja
        config-opts:
          - -DMSGPACK_ENABLE_STATIC=ON
          - -DMSGPACK_ENABLE_SHARED=OFF
        sources:
          - type: archive
            url: https://github.com/msgpack/msgpack-c/releases/download/c-4.0.0/msgpack-c-4.0.0.tar.gz
            sha256: 420fe35e7572f2a168d17e660ef981a589c9cbe77faa25eb34a520e1fcc032c8
            x-checker-data:
              type: anitya
              project-id: 235285
              stable-only: true
              url-template: https://github.com/msgpack/msgpack-c/releases/download/c-$version/msgpack-c-$version.tar.gz
        cleanup:
          - /lib/cmake
      - name: tree-sitter-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
        post-install:
          - rm ${FLATPAK_DEST}/lib/libtree-sitter.so*
        sources:
          - type: archive
            url: https://github.com/tree-sitter/tree-sitter/archive/v0.20.6/tree-sitter-0.20.6.tar.gz
            sha256: 4d37eaef8a402a385998ff9aca3e1043b4a3bba899bceeff27a7178e1165b9de
            x-checker-data:
              type: anitya
              project-id: 142464
              stable-only: true
              url-template: https://github.com/tree-sitter/tree-sitter/archive/v$version/tree-sitter-$version.tar.gz

  - name: neovide
    buildsystem: simple
    build-commands:
      - install -Dm755 neovide -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 3
        url: https://github.com/neovide/neovide/releases/download/0.9.0/neovide.tar.gz
        sha256: 684cbcaeb2e67f1d95822ef80e03e1475395d537f2032f47b8202fe48c428b08
        x-checker-data:
          type: json
          url: https://api.github.com/repos/neovide/neovide/releases/latest
          version-query: .tag_name
          url-query: '"https://github.com/neovide/neovide/releases/download/" + $version
            + "/neovide.tar.gz"'

  - name: kakoune-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
      - libexecdir=${FLATPAK_DEST}/lib/kak
    sources:
      - type: archive
        url: https://github.com/mawww/kakoune/releases/download/v2021.11.08/kakoune-2021.11.08.tar.bz2
        sha256: aa30889d9da11331a243a8f40fe4f6a8619321b19217debac8f565e06eddb5f4
        x-checker-data:
          type: anitya
          project-id: 17726
          stable-only: true
          url-template: https://github.com/mawww/kakoune/releases/download/v$version/kakoune-$version.tar.bz2
    modules:
      - name: kak-lsp
        buildsystem: simple
        build-commands:
          - install -Dm755 kak-lsp -t ${FLATPAK_DEST}/bin/
          - install -Dm644 kak-lsp.toml -t ${FLATPAK_DEST}/share/kak-lsp/examples/
          - install -Dm644 rc/lsp.kak -t ${FLATPAK_DEST}/share/kak-lsp/rc/
        sources:
          - type: archive
            url: https://github.com/kak-lsp/kak-lsp/archive/v12.2.1/kak-lsp-12.2.1.tar.gz
            sha256: 3769883060ff837a6eb8220943290e32fcafa9fe86a9c2231b1cdb391d35be66
            x-checker-data:
              type: anitya
              project-id: 267541
              stable-only: true
              url-template: https://github.com/kak-lsp/kak-lsp/archive/v$version/kak-lsp-$version.tar.gz
          - type: archive
            strip-components: 0
            url: https://github.com/kak-lsp/kak-lsp/releases/download/v12.2.1/kak-lsp-v12.2.1-x86_64-unknown-linux-musl.tar.gz
            sha256: 967ebf39a4942765c6a36dc4ca411603a173d70b4d69be80db91eab306e9a0ac
            x-checker-data:
              type: anitya
              project-id: 267541
              stable-only: true
              url-template: https://github.com/kak-lsp/kak-lsp/releases/download/v$version/kak-lsp-v$version-x86_64-unknown-linux-musl.tar.gz


  ############################
  ####     Clipboard      ####
  ############################

  - name: wl-clipboard-static
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - -Dfishcompletiondir=no
      - -Dzshcompletiondir=no
    cleanup:
      - /share/bash-completion
      - /share/zsh
    sources:
      - type: archive
        url: https://github.com/bugaevc/wl-clipboard/archive/v2.1.0/wl-clipboard-2.1.0.tar.gz
        sha256: 72dab9a7d3835c76d6ff2089f15ffec9e064a321e5f3cbbe961a8fa81aff5573
        x-checker-data:
          type: anitya
          project-id: 49082
          stable-only: true
          url-template: https://github.com/bugaevc/wl-clipboard/archive/v$version/wl-clipboard-$version.tar.gz

  - name: xclip-static
   #build-options: *musl-static-build-options
    build-options:
      cflags: -static
      cxxflags: -static
      ldflags: -static
      env:
        - CC=x86_64-linux-musl-gcc
        - CXX=x86_64-linux-musl-g++
        - LIBS=-lX11 -lxcb -lX11-xcb -lXau -lxcb-xinput -lxcb-xkb -lXdmcp -lXext -lXmu
          -lXmuu -lXt -lSM -lICE
    sources:
      - type: archive
        url: https://github.com/astrand/xclip/archive/0.13/xclip-0.13.tar.gz
        sha256: ca5b8804e3c910a66423a882d79bf3c9450b875ac8528791fb60ec9de667f758
        x-checker-data:
          type: anitya
          project-id: 14150
          stable-only: true
          url-template: https://github.com/astrand/xclip/archive/$version/xclip-$version.tar.gz
    cleanup:
      - /bin/xclip-*file
# - name: xsel-static
#  #build-options: *musl-static-build-options
#   build-options:
#     cflags: -static
#     cxxflags: -static
#     ldflags: -static
#     env:
#       - CC=x86_64-linux-musl-gcc
#       - CXX=x86_64-linux-musl-g++
#       - LIBS=-lX11 -lxcb -lX11-xcb -lXau -lxcb-xinput -lxcb-xkb -lXdmcp -lXext -lXmu -lXmuu -lXt
#   sources:
#     - type: archive
#       url: https://github.com/kfish/xsel/archive/9fc4e3e4e3f1231cabfdc2e1438155f9390bc517/xsel-9fc4e3e4e3f1231cabfdc2e1438155f9390bc517.tar.gz
#       sha256: 6269fa7b58f157bd5796b1ce82797922fe62495a61b95f565c48708a12030443
#      #x-checker-data:
#      #  type: anitya
#      #  project-id:
#      #  stable-only: true
#      #  url-template:


  ############################
  ####    File search     ####
  ############################

  - name: broot
    buildsystem: simple
    build-commands:
      - install -Dm755 x86_64-unknown-linux-musl/broot -t ${FLATPAK_DEST}/bin/
      - install -Dm644 broot.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 completion/broot.bash ${FLATPAK_DEST}/share/bash-completion/completions/broot
      - install -Dm644 completion/broot.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/broot.fish
      - install -Dm644 completion/_broot ${FLATPAK_DEST}/share/zsh/site-functions/_broot
      - install -Dm644 resources/vscode.ttf -t ${FLATPAK_DEST}/share/fonts/vscode/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/Canop/broot/releases/download/v1.14.2/broot_1.14.2.zip
        sha256: 4e9bc7d5bc793deec387700c2258339b51e2dd499b41c010f8e0027e6a5d854c
        x-checker-data:
          type: anitya
          project-id: 141357
          stable-only: true
          url-template: https://github.com/Canop/broot/releases/download/v$version/broot_$version.zip

  - name: skim
    buildsystem: simple
    build-commands:
      - install -Dm755 sk bin/sk-tmux -t ${FLATPAK_DEST}/bin/
      - install -Dm644 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 shell/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/sk
      - install -Dm644 shell/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_sk
      - install -Dm644 shell/key-bindings.{bash,zsh} -t ${FLATPAK_DEST}/share/skim/
      - install -Dm644 shell/key-bindings.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/skim_key_bindings.fish
      - install -Dm644 plugin/skim.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/plugin/
    sources:
      - type: archive
        url: https://github.com/lotabout/skim/archive/v0.9.4/skim-0.9.4.tar.gz
        sha256: 5ec639c34c7657be4f7f990e9ad0d8d0a7a979eba68daa7c100126ce06702a1b
        x-checker-data:
          type: anitya
          project-id: 16131
          stable-only: true
          url-template: https://github.com/lotabout/skim/archive/v$version/skim-$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/lotabout/skim/releases/download/v0.9.4/skim-v0.9.4-x86_64-unknown-linux-musl.tar.gz
        sha256: a73c94622d9aaab18f9a03a9bf7af0ca2f7059280ea3df24c09c1e7e0b359c32
        x-checker-data:
          type: anitya
          project-id: 16131
          stable-only: true
          url-template: https://github.com/lotabout/skim/releases/download/v$version/skim-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: ugrep-static
    build-options: *musl-static-build-options
    config-opts:
      - --with-bzlib=/usr/lib/sdk/devenv
      - --with-lz4=/usr/lib/sdk/devenv
      - --with-lzma=/usr/lib/sdk/devenv
      - --with-pcre2=/usr/lib/sdk/devenv
      - --with-zlib=/usr/lib/sdk/devenv
      - --with-zstd=/usr/lib/sdk/devenv
    sources:
      - type: archive
        url: https://github.com/Genivia/ugrep/archive/v3.8.3/ugrep-3.8.3.tar.gz
        sha256: deb7e143ee07019fdaa98a4529596d965185542a195855c1bfb6779fb8dd5e55
        x-checker-data:
          type: anitya
          project-id: 187554
          stable-only: true
          url-template: https://github.com/Genivia/ugrep/archive/v$version/ugrep-$version.tar.gz

  - name: ripgrep
    buildsystem: simple
    build-commands:
      - install -Dm755 rg -t ${FLATPAK_DEST}/bin/
      - install -Dm644 doc/rg.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 complete/rg.bash ${FLATPAK_DEST}/share/bash-completion/completions/rg
      - install -Dm644 complete/rg.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/rg.fish
      - install -Dm644 complete/_rg ${FLATPAK_DEST}/share/zsh/site-functions/_rg
    sources:
      - type: archive
        url: https://github.com/BurntSushi/ripgrep/releases/download/13.0.0/ripgrep-13.0.0-x86_64-unknown-linux-musl.tar.gz
        sha256: ee4e0751ab108b6da4f47c52da187d5177dc371f0f512a7caaec5434e711c091
        x-checker-data:
          type: anitya
          project-id: 15461
          stable-only: true
          url-template: https://github.com/BurntSushi/ripgrep/releases/download/$version/ripgrep-$version-x86_64-unknown-linux-musl.tar.gz

  - name: fzy-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/jhawthorn/fzy/archive/1.0/fzy-1.0.tar.gz
        sha256: 80257fd74579e13438b05edf50dcdc8cf0cdb1870b4a2bc5967bd1fdbed1facf
        x-checker-data:
          type: anitya
          project-id: 267539
          stable-only: true
          url-template: https://github.com/jhawthorn/fzy/archive/$version/fzy-$version.tar.gz

  - name: patchelf-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: https://github.com/NixOS/patchelf/archive/0.15.0.tar.gz
        sha256: 5d1eda9bad4439bb9c0a87fcba198d7c0d372f361e77de41d68d6308062e5000
        x-checker-data:
          type: anitya
          project-id: 2598
          stable-only: true
          url-template: https://github.com/NixOS/patchelf/archive/$version.tar.gz

  - name: fzf
    buildsystem: simple
    build-commands:
      - install -Dm755 fzf bin/fzf-tmux -t ${FLATPAK_DEST}/bin/
      - install -Dm644 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 shell/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/fzf
     #- install -Dm644 shell/completion.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/fzf.fish
      - install -Dm644 shell/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_fzf
      - install -Dm644 shell/key-bindings.{bash,zsh} -t ${FLATPAK_DEST}/share/fzf/
      - install -Dm644 shell/key-bindings.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/fzf_key_bindings.fish
      - install -Dm644 doc/fzf.txt -t ${FLATPAK_DEST}/share/vim/vimfiles/doc/
      - install -Dm644 plugin/fzf.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/plugin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/junegunn/fzf/releases/download/0.31.0/fzf-0.31.0-linux_amd64.tar.gz
        sha256: c13d0370b4166136bd91cdcb03ef0580d26911859aba3e7077c2cba61bd93e45
        x-checker-data:
          type: anitya
          project-id: 15856
          stable-only: true
          url-template: https://github.com/junegunn/fzf/releases/download/$version/fzf-$version-linux_amd64.tar.gz
      - type: archive
        url: https://github.com/junegunn/fzf/archive/0.31.0/fzf-0.31.0.tar.gz
        sha256: df4edee32cb214018ed40160ced968d4cc3b63bba5b0571487011ee7099faa76
        x-checker-data:
          type: anitya
          project-id: 15856
          stable-only: true
          url-template: https://github.com/junegunn/fzf/archive/$version/fzf-$version.tar.gz


  ############################
  ####    File manager    ####
  ############################

  - name: lf
    # TODO: possible modules lfp, ez, lfutils, pistol, stpv
    buildsystem: simple
    build-commands:
      - install -Dm755 lf -t ${FLATPAK_DEST}/bin/
      - install -Dm644 lf.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 etc/lf.bash ${FLATPAK_DEST}/share/bash-completion/completions/lf
      - install -Dm644 etc/lf.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/lf.fish
      - install -Dm644 etc/lf.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_lf
      - install -Dm644 etc/lfcd.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/lfcd.fish
      - install -Dm644 etc/lfcd.sh -t ${FLATPAK_DEST}/share/lf/
      - install -Dm644 etc/lfrc.example -t ${FLATPAK_DEST}/share/lf/
      - install -Dm644 etc/lf.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/syntax/
      - install -Dm644 etc/lf.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/ftdetect/
    sources:
      - type: archive
        url: https://github.com/gokcehan/lf/archive/r27/lf-27.tar.gz
        sha256: cdd132e33387423ef9f9448e21d3f1e5c9a5319b34fdfb53cb5f49351ebac005
        x-checker-data:
          type: anitya
          project-id: 269016
          stable-only: true
          url-template: https://github.com/gokcehan/lf/archive/r$version/lf-$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/gokcehan/lf/releases/download/r27/lf-linux-amd64.tar.gz
        sha256: b8f9431dc63f7b2cff8e4306cff4c075adbe9f0900b563f91a6b742a41290d7f
        x-checker-data:
          type: anitya
          project-id: 269016
          stable-only: true
          url-template: https://github.com/gokcehan/lf/releases/download/r$version/lf-linux-amd64.tar.gz

  - name: nnn
    buildsystem: simple
    build-commands:
      - install -Dm755 nnn-musl-static ${FLATPAK_DEST}/bin/nnn
      - install -Dm644 nnn.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 misc/auto-completion/bash/nnn-completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/nnn
      - install -Dm644 misc/auto-completion/fish/nnn.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/nnn.fish
      - install -Dm644 misc/auto-completion/zsh/_nnn ${FLATPAK_DEST}/share/zsh/site-functions/_nnn
      - install -Dm644 misc/quitcd/quitcd.{bash_zsh,fish} -t ${FLATPAK_DEST}/share/nnn/quitcd/
      - install -dm755 ${FLATPAK_DEST}/share/nnn
      - cp -r plugins ${FLATPAK_DEST}/share/nnn/
    sources:
      - type: archive
        url: https://github.com/jarun/nnn/releases/download/v4.5/nnn-v4.5.tar.gz
        sha256: fadc15bd6d4400c06e5ccc47845b42e60774f368570e475bd882767ee18749aa
        x-checker-data:
          type: anitya
          project-id: 17080
          stable-only: true
          url-template: https://github.com/jarun/nnn/releases/download/v$version/nnn-v$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/jarun/nnn/releases/download/v4.5/nnn-musl-static-4.5.x86_64.tar.gz
        sha256: 471273a7a1a56e2c3e50353658b5679d4a5c47d423f4eaaf010caa0f6dcaf981
        x-checker-data:
          type: anitya
          project-id: 17080
          stable-only: true
          url-template: https://github.com/jarun/nnn/releases/download/v$version/nnn-musl-static-$version.x86_64.tar.gz

  - name: ranger
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --skip-build --prefix=${FLATPAK_DEST} --root=/ --optimize=1
      - mv ${FLATPAK_DEST}/bin/ranger{,-org}
    sources:
      - type: archive
        url: https://ranger.github.io/ranger-1.9.3.tar.gz
        sha256: ce088a04c91c25263a9675dc5c43514b7ec1b38c8ea43d9a9d00923ff6cdd251
        x-checker-data:
          type: html
          url: https://ranger.github.io/download.html
          version-pattern: ranger-([\d\.-]+).tar.gz
          url-template: https://ranger.github.io/ranger-$version.tar.gz
      - type: patch
        path: ranger-sixel.patch
      - type: patch
        path: ranger-tmux-fixes.patch
    cleanup:
      - '*'

  - name: ranger-portable
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands:
      - ln -s ${FLATPAK_DEST}/bin/ranger-org ranger-portable
      - pyinstaller --onedir --collect-all ranger ranger-portable
      - cp -r dist/ranger-portable ${FLATPAK_DEST}/lib/
      - ln -s ../lib/ranger-portable/ranger-portable ${FLATPAK_DEST}/bin/ranger
    cleanup:
      - /lib/python*

  - name: vifm-static
    build-options: *musl-static-build-options
    config-opts:
      # actually used to set -I${vifm_cv_curses}/include/${curses_lib_name}
      - --with-curses=/usr/lib/sdk/devenv
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/vifm/vifm-0.12.tar.bz2
        sha256: 33a9618f32b35b5b8c64483884f9ad09963ca8465b2935def79159028e27b2c0
        x-checker-data:
          type: html
          url: https://vifm.info/downloads.shtml
          version-pattern: vifm-([\d\.-]*).tar.bz2
          url-template: https://prdownloads.sourceforge.net/vifm/vifm-$version.tar.bz2
    cleanup:
      - /share/applications
      - /share/pixmaps


  ############################
  ####        VCS         ####
  ############################

  - name: github-cli
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/gh -t ${FLATPAK_DEST}/bin/
      - install -Dm644 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - bin/gh completion -s bash | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/bash-completion/completions/gh
      - bin/gh completion -s fish | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/fish/vendor_completions.d/gh.fish
      - bin/gh completion -s zsh | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/zsh/site-functions/_gh
    sources:
      - type: archive
        url: https://github.com/cli/cli/releases/download/v2.14.2/gh_2.14.2_linux_amd64.tar.gz
        sha256: 3d4be4bf3446622c51192529f963d8719a2c78cc545aeab6fefff1c9ecf5b346
        x-checker-data:
          type: anitya
          project-id: 135615
          stable-only: true
          url-template: https://github.com/cli/cli/releases/download/v$version/gh_${version}_linux_amd64.tar.gz

  - name: github-hub
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/hub -t ${FLATPAK_DEST}/bin/
      - install -Dm644 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 etc/hub.bash_completion.sh ${FLATPAK_DEST}/share/bash-completion/completions/hub
      - install -Dm644 etc/hub.fish_completion ${FLATPAK_DEST}/share/fish/vendor_completions.d/hub.fish
      - install -Dm644 etc/hub.zsh_completion ${FLATPAK_DEST}/share/zsh/site-functions/_hub
      - cp -a share/vim ${FLATPAK_DEST}/share/
    sources:
      - type: archive
        url: https://github.com/github/hub/releases/download/v2.14.2/hub-linux-amd64-2.14.2.tgz
        sha256: 74d95fdfb3c78c8af4e2025b04b916ad905ab99a361778500d58269847c7922d
        x-checker-data:
          type: anitya
          project-id: 5368
          stable-only: true
          url-template: https://github.com/github/hub/releases/download/v$version/hub-linux-amd64-$version.tgz

  - name: gitlab-cli
    buildsystem: simple
    build-commands:
      - bsdtar -Oxf glab.deb 'data.tar*' | bsdtar -xf - --strip-components=2
      - install -Dm755 bin/glab -t ${FLATPAK_DEST}/bin/
      - install -Dm644 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - bin/glab completion -s bash | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/bash-completion/completions/glab
      - bin/glab completion -s fish | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/fish/vendor_completions.d/glab.fish
      - bin/glab completion -s zsh | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/zsh/site-functions/_glab
    sources:
      - type: file
        dest-filename: glab.deb
        url: https://github.com/profclems/glab/releases/download/v1.22.0/glab_1.22.0_Linux_x86_64.deb
        sha256: 5761f235ee5ef358dabcb8a5d86013572eb504cc43237b84c258114ab3fd7c27
        x-checker-data:
          type: anitya
          project-id: 127208
          stable-only: true
          url-template: https://github.com/profclems/glab/releases/download/v$version/glab_${version}_Linux_x86_64.deb

  - name: gitlab-release-cli
    buildsystem: simple
    build-commands:
      - install -Dm755 release-cli -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: release-cli
        url: https://gitlab.com/gitlab-org/release-cli/-/releases/v0.13.0/downloads/bin/release-cli-linux-amd64
        sha256: 5afa1cd8d6713e15a3627d0fb53cbc5f084912c6b404507b60c175832eb9b386
        x-checker-data:
          type: anitya
          project-id: 267525
          stable-only: true
          url-template: https://gitlab.com/gitlab-org/release-cli/-/releases/v$version/downloads/bin/release-cli-linux-amd64

  - name: gitea-tea
    buildsystem: simple
    build-commands:
      - install -Dm755 tea -t ${FLATPAK_DEST}/bin/
      - install -Dm644 contrib/autocomplete.sh ${FLATPAK_DEST}/share/bash-completion/completions/tea
      - install -Dm644 contrib/autocomplete.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_tea
    sources:
      - type: file
        dest-filename: tea
        url: https://gitea.com/gitea/tea/releases/download/v0.8.0/tea-0.8.0-linux-amd64
        sha256: 8bc99e0532548365f3d86a5ec319772121a844d54a01cb51cddb030d05f27a0c
        x-checker-data:
          type: json
          url: https://gitea.com/api/v1/repos/gitea/tea/releases
          version-query: first(.[].tag_name | sub("^v"; ""))
          url-query: '"https://gitea.com/gitea/tea/releases/download/v" + $version
            + "/tea-" + $version + "-linux-amd64"'
      - type: archive
        url: https://gitea.com/gitea/tea/archive/v0.8.0.tar.gz
        sha256: 6c73c0a7b66cdfd1e5a302257d54df06a3a41eb9bdbfeb547966db431ae23b23
        x-checker-data:
          type: json
          url: https://gitea.com/api/v1/repos/gitea/tea/releases
          version-query: first(.[].tag_name | sub("^v"; ""))
          url-query: '"https://gitea.com/gitea/tea/archive/v" + $version + ".tar.gz"'


  ############################
  ####    File archive    ####
  ############################

  - name: p7zip-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
     # TODO: build 7z with shared musl libc
     #- 7z
      - 7zr
      - 7za
      - OPTFLAGS:=${CFLAGS}
    make-install-args:
      - DEST_DIR=/
      - DEST_HOME=${FLATPAK_DEST}
      - DEST_MAN=${FLATPAK_DEST}/share/man
    sources:
      - type: archive
        url: https://github.com/jinfeihan57/p7zip/archive/eb1bbb0d0327a103850fec519015986e72a1ebf0.tar.gz
        sha256: cecdaa7e2738ad4594ddddb0c568db1750b7a7ff8433961be8595033d444e3a7
        x-checker-data:
          type: anitya
          project-id: 2583
          stable-only: true
          versions:
            '>': '17.04'
          url-template: https://github.com/jinfeihan57/p7zip/archive/v$version/p7zip-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^CC/d;/^CXX/d;/^CC_SHARED/d;/^LINK_SHARED/d' makefile.machine
    cleanup:
      - /share/doc


  ############################
  ####     Containers     ####
  ############################

  - name: host-spawn
    buildsystem: simple
    build-commands:
      - install -Dm755 host-spawn -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: host-spawn
        url: https://github.com/1player/host-spawn/releases/download/1.0.2/host-spawn-x86_64
        sha256: feeda9c20684481e522b2dafa3308b442c21577eaa2b4a9f49f643103b6ffe94
        x-checker-data:
          type: json
          url: https://api.github.com/repos/1player/host-spawn/releases/latest
          version-query: .tag_name
          url-query: '"https://github.com/1player/host-spawn/releases/download/" +
            $version + "/host-spawn-x86_64"'


  ############################
  ####     Trash can      ####
  ############################

  # TODO: evaluate garbage @ https://git.sr.ht/~mzhang/garbage
  - name: rmtrash
    buildsystem: simple
    build-commands:
      - install -Dm755 rmtrash rmdirtrash -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        url: https://github.com/PhrozenByte/rmtrash/archive/v1.14/rmtrash-1.14.tar.gz
        sha256: 119cf1a5e9c5ecadb95cfcc46999a5db6d55e0bb822f411c9a1b9c7d0cdf76b7
        x-checker-data:
          type: anitya
          project-id: 267500
          stable-only: true
          url-template: https://github.com/PhrozenByte/rmtrash/archive/v$version/rmtrash-$version.tar.gz
    modules:
      - name: trash-cli
        build-options: *musl-shared-build-options
#       build-options:
#         cflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
#         cxxflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
#         ldflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/ld-musl-x86_64.so.1
#         env:
#           - CC=x86_64-linux-musl-gcc
#           - CXX=x86_64-linux-musl-g++
        buildsystem: simple
        build-commands:
          - pip3 install --exists-action=i --no-index --find-links=file://$PWD --prefix=$FLATPAK_DEST
            trash-cli --no-build-isolation
          - |
            for app in trash{,-empty,-list,-put,-restore,-rm}; do
              mv ${FLATPAK_DEST}/bin/${app}{,-org}
            done
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/36/d2/6415cda6cdd81ee0eb07b357e96a03c96a78af324d7eb2c52ff51d080210/trash-cli-0.22.4.16.tar.gz
            sha256: ec60ff1a038402f4b1e7360b32707bc36dc275fa32e512bb81274c0375d20003
            x-checker-data:
              type: pypi
              name: trash-cli
          - type: file
            url: https://files.pythonhosted.org/packages/d6/de/0999ea2562b96d7165812606b18f7169307b60cd378bc29cf3673322c7e9/psutil-5.9.1.tar.gz
            sha256: 57f1819b5d9e95cdfb0c881a8a5b7d542ed0b7c522d575706a80bedc848c8954
            x-checker-data:
              type: pypi
              name: psutil
        cleanup:
          - '*'

  - name: trash-cli-portable
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands:
      - |
        for app in trash{,-empty,-list,-put,-restore,-rm}; do
          ln -s ${FLATPAK_DEST}/bin/${app}-org ${app}
        done
     #- |
     #  for app in trash{,-empty,-list,-put,-restore,-rm}; do
     #    pyi-makespec ${app}
     #  done
      - pyinstaller trashcli.spec
      - install -dm755 ${FLATPAK_DEST}/lib/trash-cli-portable
      - |
        for app in trash{,-empty,-list,-put,-restore,-rm}; do
          cp -r dist/${app}/* ${FLATPAK_DEST}/lib/trash-cli-portable/
        done
      - |
        for app in trash{,-empty,-list,-put,-restore,-rm}; do
          ln -s ../lib/trash-cli-portable/${app} ${FLATPAK_DEST}/bin/${app}
        done
    sources:
      - type: file
        path: trashcli.spec
    cleanup:
      - /lib/python*

  ############################
  ####     Dotfiles       ####
  ############################

  - name: stow
    # TODO: replace this with binary alternative
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/stow/stow-2.3.1.tar.gz
        sha256: 09d5d99671b78537fd9b2c0b39a5e9761a7a0e979f6fdb7eabfa58ee45f03d4b
        x-checker-data:
          type: anitya
          project-id: 4900
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/stow/stow-$version.tar.gz
    cleanup:
      - /share/doc
      - /share/info


  ############################
  ####    Folder view    #####
  ############################

  - name: exa
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/exa -t ${FLATPAK_DEST}/bin/
      - install -Dm644 completions/exa.bash ${FLATPAK_DEST}/share/bash-completion/completions/exa
      - install -Dm644 completions/exa.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/exa.fish
      - install -Dm644 completions/exa.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_exa
      - install -Dm644 man/exa.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 man/exa_colors.5 -t ${FLATPAK_DEST}/share/man/man5/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/ogham/exa/releases/download/v0.10.1/exa-linux-x86_64-musl-v0.10.1.zip
        sha256: 790311d6167c2b439dee253d548c8fcb67809aa6704bc2c4f2b8dd25cf6fdd31
        x-checker-data:
          type: anitya
          project-id: 16575
          stable-only: true
          url-template: https://github.com/ogham/exa/releases/download/v$version/exa-linux-x86_64-musl-v$version.zip

  - name: lsd
    buildsystem: simple
    build-commands:
      - install -Dm755 lsd -t ${FLATPAK_DEST}/bin/
      - install -Dm644 autocomplete/lsd.bash-completion ${FLATPAK_DEST}/share/bash-completion/completions/lsd
      - install -Dm644 autocomplete/lsd.fish -t ${FLATPAK_DEST}/share/fish/vendor_completions.d/
      - install -Dm644 autocomplete/_lsd -t ${FLATPAK_DEST}/share/zsh/site-functions/
      - install -Dm644 lsd.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/Peltoche/lsd/releases/download/0.22.0/lsd-0.22.0-x86_64-unknown-linux-gnu.tar.gz
        sha256: 1d5ad5b09c8f5b974f96439725b150fb87e4587e27d57a1d8c4486a73629890c
        x-checker-data:
          type: anitya
          project-id: 20242
          stable-only: true
          url-template: https://github.com/Peltoche/lsd/releases/download/$version/lsd-$version-x86_64-unknown-linux-gnu.tar.gz


  ############################
  ####      Images        ####
  ############################

  - name: chafa
    buildsystem: simple
    no-make-install: true
    make-args:
      - chafa.1
    build-commands:
      - install -Dm755 bin/chafa -t ${FLATPAK_DEST}/bin/
      - install -Dm644 docs/chafa.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/hpjansson/chafa/releases/download/1.12.3/chafa-1.12.3.tar.xz
        sha256: 2456a0b6c1150e25b64cd6a92810d59bed3f061f8b86f91aba5a77bc7cc76cfa
        x-checker-data:
          type: anitya
          project-id: 17542
          stable-only: true
          url-template: https://github.com/hpjansson/chafa/releases/download/$version/chafa-$version.tar.xz
      - type: archive
        dest: bin
        url: https://hpjansson.org/chafa/releases/static/chafa-1.12.3-1-x86_64-linux-gnu.tar.gz
        sha256: dba44781ff83bffb0eaaaf4a72381d956f52137d11e108b438da3a6ed7c9c668
        x-checker-data:
          type: anitya
          project-id: 17542
          stable-only: true
          url-template: https://hpjansson.org/chafa/releases/static/chafa-$version-1-x86_64-linux-gnu.tar.gz

  - name: sic
    buildsystem: simple
    build-commands:
      - install -Dm755 convert sic -t ${FLATPAK_DEST}/bin/
      - install -Dm644 sic.bash ${FLATPAK_DEST}/share/bash-completion/completions/sic
      - install -Dm644 sic.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/sic.fish
      - install -Dm644 _sic ${FLATPAK_DEST}/share/zsh/site-functions/_sic
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/foresterre/sic/releases/download/v0.20.0/shell_completions.zip
        sha256: 45dbbc2af3eb18ae05d8aeeff748a15a052fb2fc3b4ca703c193df8aa0b0ee0b
        x-checker-data:
          type: anitya
          project-id: 268144
          stable-only: true
          url-template: https://github.com/foresterre/sic/releases/download/v$version/shell_completions.zip
      - type: archive
        strip-components: 0
        url: https://github.com/foresterre/sic/releases/download/v0.20.0/sic-0.20.0-x86_64-unknown-linux-gnu.zip
        sha256: dd75ef69e5495939ac81af93a29aea9228eb09f7f0c7757c1cf501ec0eb92f30
        x-checker-data:
          type: anitya
          project-id: 268144
          stable-only: true
          url-template: https://github.com/foresterre/sic/releases/download/v$version/sic-$version-x86_64-unknown-linux-gnu.zip
      - type: script
        # get ranger-sixel working without imagemagick
        dest-filename: convert
        commands:
          # infile -geometry wxh sixel:-
          - exec sic --input "${1%\[0\]}" --resize "${3%x*}" "${3#*x}" --output-format
            BMP 2>/dev/null | img2sixel -


  ############################
  ####     File sync      ####
  ############################

  - name: rsync-static
    build-options: *musl-static-build-options
    config-opts:
     #- --help
      # TODO: enable man pages
      - --disable-md2man
      - --with-included-popt=no
      - --with-included-zlib=no
      - --disable-locale
    sources:
      - type: archive
        url: https://github.com/WayneD/rsync/archive/v3.2.4/-rsync-3.2.4.tar.gz
        sha256: 4d8543cf5da694169e1d51bd9f757a80a1fa9c3d6cb1100e9816a7e85ed57aec
        x-checker-data:
          type: anitya
          project-id: 4217
          stable-only: true
          url-template: https://github.com/WayneD/rsync/archive/v$version/-rsync-$version.tar.gz


  ############################
  ####       Polish       ####
  ############################

  - name: packaging
    buildsystem: simple
    build-commands:
      - install -Dm755 enable{,-sdks}.sh -t ${FLATPAK_DEST}/
      - install -Dm755 enable-development-environment ssh -t ${FLATPAK_DEST}/bin/
      - install -Dm644 bash.bashrc -t ${FLATPAK_DEST}/etc/
      - ln -s nvim ${FLATPAK_DEST}/bin/vim
    sources:
      - type: script
        dest-filename: enable.sh
        commands:
          - |
            if [ -z "$FLATPAK_DEVELOPMENT_ENVIRONMENT" ]; then
              export FLATPAK_DEVELOPMENT_ENVIRONMENT=1
              SDKPATH=/usr/lib/sdk/devenv
              export PATH=${SDKPATH}/bin:$PATH
              export XDG_DATA_DIRS=$XDG_DATA_DIRS:${SDKPATH}/share
              if [ -z "$LD_LIBRARY_PATH" ]; then
                export LD_LIBRARY_PATH=${SDKPATH}/lib
              else
                export LD_LIBRARY_PATH+=:${SDKPATH}/lib
              fi
              if [ -z "$PYTHONPATH" ]; then
                export PYTHONPATH=${SDKPATH}/lib/python/site-packages
              else
                export PYTHONPATH+=:${SDKPATH}/lib/python/site-packages
              fi
              if [[ ":$TERMINFO_DIRS:" != *":${SDKPATH}/share/terminfo:"* ]]; then
                if [[ "$TERMINFO_DIRS" != *":" ]] && [ -n "$TERMINFO_DIRS" ]; then
                  export TERMINFO_DIRS+=":${SDKPATH}/share/terminfo:"
                else
                  export TERMINFO_DIRS+="${SDKPATH}/share/terminfo:"
                fi
              fi
            fi
      - type: script
        dest-filename: enable-development-environment
        commands:
          - |
            if [ -z "$FLATPAK_DEVELOPMENT_ENVIRONMENT" ]; then
              source /usr/lib/sdk/devenv/enable.sh
              exec bash -i
            fi
      - type: script
        dest-filename: ssh
        commands:
          - |
            /usr/bin/ssh \
            -F /home/${USER}/.config/ssh/config \
            -o "UserKnownHostsFile /home/${USER}/.config/ssh/known_hosts" \
            "$@"
      - type: file
        path: enable-sdks.sh
      - type: file
        path: bash.bashrc
      - type: file
        path: inputrc
