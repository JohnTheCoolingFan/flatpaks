# TODO: helper scripts
#         fix enable-sdks.sh
#         flatpak-builder like env vars
#         set local installation targets: python, golang, rust
#           node: NPM_PACKAGES=xdg-data/npm-packages
#                 PATH+=:xdg-data/npm-packages/bin
# TODO: add more patched fonts: nerd-fonts
# TODO: investigate broken host tmux sessions

# documentation
#
#   fontconfig
#     add to fonts.conf see flatpaks README.md
#     now: <dir>/usr/lib/sdk/devenv/share/fonts/powerline</dir>
#     next: <dir prefix="xdg">fonts/powerline</dir>
#     see also https://gitlab.freedesktop.org/fontconfig/fontconfig/-/commit/6f27f42e6140030715075aa3bd3e5cc9e2fdc6f1
#
#   easily enable after entering a sandbox
#     add override for envvar
#       `$ flatpak override --user --env=ENABLE_DEVENV=/usr/lib/sdk/devenv/bin/enable-development-environment`
#     enter sandbox and then use envvar to run shell
#       `$ $ENABLE_DEVENV`
#
#   enter a sandbox with enabled shell
#     set envvar in host shell
#       `$ export fpde=/usr/lib/sdk/devenv/bin/enable-development-environment`
#     enter sandbox
#       `$ flatpak run --command=$fpde org.freedesktop.Sdk//21.08`
#
#   enable by default, only works with actual apps, not runtimes
#     add persist override
#       `$ flatpak override --user --persist=. FLATPAK_ID`
#     enter sandbox
#       `$ flatpak run FLATPAK_ID`
#     create .bashrc
#       `$ echo 'source $ENABLE_DEVENV' > .bashrc`
#
#   terminfo: use updated db
#     optional as it's already set by the enable.sh script
#     if added to an app packaging, must use quotes like the example
#     - '--env=TERMINFO_DIRS=/usr/lib/sdk/devenv/share/terminfo:'
#
#   permissions
#     ssh
#       --filesystem=xdg-config/ssh:ro
#       my secret store for storing keys, needed due to symlinks from xdg-config/ssh
#         --filesystem=~/.user/hiddendots/openssh:ro
#       this is the location of my ssh-agent's socket, and likely not needed anymore with new flatpak releases
#         --filesystem=xdg-run/ssh-agent:ro
#       this might be already enabled, it only used by gnome-keyring's agent, and basically bind mounts bind-mounts the xdg-run/ssh-auth
#         --socket=ssh-auth
#       for app/sandbox specific setting, like automatically added known hosts
#         --persist=.ssh
#       only needed with older than flatpak 1.11.1 https://github.com/flatpak/flatpak/commit/0e0e98e7ef0498946d8172ac6d266679434aab6a
#         --env=SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/ssh-agent/sock
#       when using non-default ssh config folder, explictly set IdentityFile
#         Host *
#           IdentityFile ~/.config/ssh/id_rsa
#           IdentityFile ...
#
#     gnupg
#       --filesystem=xdg-config/gnupg:ro
#     code
#       --filesystem=~/projects
#     ccache
#       --filesystem=xdg-cache/ccache
#     byobu
#       --filesystem=xdg-config/byobu/.ssh-agent
#       --filesystem=xdg-run/tmux
#     flatpak-spawn
#       --talk-name=org.freedesktop.Flatpak
#     git
#       --filesystem=xdg-config/git:ro
#     nvim
#       --filesystem=xdg-config/nvim:ro
#       --filesystem=xdg-data/nvim:ro

id: org.freedesktop.Sdk.Extension.devenv
branch: '21.08'
runtime: org.freedesktop.Sdk
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
build-options:
  cflags: -I/usr/lib/sdk/devenv/include
  cxxflags: -I/usr/lib/sdk/devenv/include
  ldflags: -L/usr/lib/sdk/devenv/lib
  prefix: /usr/lib/sdk/devenv
  libdir: /usr/lib/sdk/devenv/lib
  prepend-path: /usr/lib/sdk/devenv/bin
  prepend-ld-library-path: /usr/lib/sdk/devenv/lib
  prepend-pkg-config-path: /usr/lib/sdk/devenv/lib/pkgconfig
  strip: true
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/applications
  - /share/cmake
  - /share/doc
  - '*.a'
  - '*.la'
modules:
  - ../shared-modules/byobu/byobu.json
  - ../shared-modules/imagemagick/imagemagick.json
  - ../shared-modules/jq/jq.json
  - ../shared-modules/neovim/neovim.json
  - ../shared-modules/p7zip/p7zip.json

  - name: bash
    build-options:
      cflags: -DDEFAULT_PATH_VALUE='"/usr/bin"' -DSTANDARD_UTILS_PATH='"/usr/bin"'
        -DDEFAULT_BASHRC='"~/.config/bash/bash.bashrc"' -DSYS_BASHRC='"/usr/lib/sdk/devenv/etc/bash.bashrc"'
        -DSYS_BASH_LOGOUT='"/usr/lib/sdk/devenv/etc/bash.bash_logout"' -DNON_INTERACTIVE_LOGIN_SHELLS
    config-opts:
      - --enable-readline
      - --with-curses
      - --with-installed-readline
      - --without-bash-malloc
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/bash/bash-5.1.16.tar.gz
        sha256: 5bac17218d3911834520dad13cd1f85ab944e1c09ae1aba55906be1f8192f558
        x-checker-data:
          type: anitya
          project-id: 166
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/bash/bash-$version.tar.gz

  - name: go-yq
    buildsystem: simple
    build-commands:
      - install -Dm755 yq -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: yq
        url: https://github.com/mikefarah/yq/releases/download/v4.25.3/yq_linux_amd64
        sha256: cb66f4382a65d0443824f0a0fcda9c5c5f7b6bd4e4346539b2f0abc647ecf0ea
        x-checker-data:
          type: json
          url: https://api.github.com/repos/mikefarah/yq/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/mikefarah/yq/releases/download/v" + $version
            + "/yq_linux_amd64"'

  - name: host-spawn
    buildsystem: simple
    build-commands:
      - install -Dm755 host-spawn -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: host-spawn
        url: https://github.com/1player/host-spawn/releases/download/1.0.1/host-spawn-x86_64
        sha256: 8458a0e200f99d535b778147a4c1b665ac14c1940b363d18e0d620631b29d312
        x-checker-data:
          type: json
          url: https://api.github.com/repos/1player/host-spawn/releases/latest
          version-query: .tag_name
          url-query: '"https://github.com/1player/host-spawn/releases/download/" +
            $version + "/host-spawn-x86_64"'

  - name: powerline-fonts
    # TODO: generate updated patched fonts with https://github.com/powerline/fontpatcher
    buildsystem: simple
    build-commands:
      # fc-match: Noto Mono for Powerline
      - install -Dm644 NotoMono/Noto\ Mono\ for\ Powerline.ttf ${FLATPAK_DEST}/share/fonts/powerline/NotoSansMonoPowerline.ttf
    sources:
      - type: archive
        url: https://github.com/powerline/fonts/archive/4622ed562eb077e502524c8a1add6d5454a057b7/powerline-4622ed562eb077e502524c8a1add6d5454a057b7.tar.gz
        sha256: 7f98d7e313d44f49c7637ce43469918cf6ba1fae1398ff5603392f7d2bc916c0
        x-checker-data:
          type: json
          url: https://api.github.com/repos/powerline/fonts/commits?sha=master&path=NotoMono&per_page=1
          version-query: .[].sha
          timestamp-query: .[].commit.committer.date
          url-query: '"https://github.com/powerline/fonts/archive/" + $version + "/powerline-" + $version + ".tar.gz"'

  - name: powerline-go
    buildsystem: simple
    build-commands:
      - install -Dm755 powerline-go -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: powerline-go
        url: https://github.com/justjanne/powerline-go/releases/download/v1.22.1/powerline-go-linux-amd64
        sha256: 1cdd4fdb5dea23fc25d59e4cc845960c60bf8ead0e9b004351ee3479d805ecb4
        x-checker-data:
          type: anitya
          project-id: 16076
          stable-only: true
          url-template: https://github.com/justjanne/powerline-go/releases/download/v$version/powerline-go-linux-amd64

  - name: stow
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/stow/stow-2.3.1.tar.gz
        sha256: 09d5d99671b78537fd9b2c0b39a5e9761a7a0e979f6fdb7eabfa58ee45f03d4b
        x-checker-data:
          type: anitya
          project-id: 4900
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/stow/stow-$version.tar.gz
    cleanup:
      - /share/doc
      - /share/info

  - name: ranger
    buildsystem: simple
    build-commands:
      - python setup.py build
      - python setup.py install --skip-build --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://ranger.github.io/ranger-1.9.3.tar.gz
        sha256: ce088a04c91c25263a9675dc5c43514b7ec1b38c8ea43d9a9d00923ff6cdd251
        x-checker-data:
          type: html
          url: https://ranger.github.io/download.html
          version-pattern: ranger-([\d\.-]+).tar.gz
          url-template: https://ranger.github.io/ranger-$version.tar.gz
      - type: patch
        path: ranger-sixel.patch
      - type: patch
        path: ranger-tmux-fixes.patch

  - name: exa
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/exa -t ${FLATPAK_DEST}/bin/
      - install -Dm644 completions/exa.bash ${FLATPAK_DEST}/share/bash-completion/completions/exa
      - install -Dm644 completions/exa.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/exa.fish
      - install -Dm644 completions/exa.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_exa
      - install -Dm644 man/exa.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 man/exa_colors.5 -t ${FLATPAK_DEST}/share/man/man5/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/ogham/exa/releases/download/v0.10.1/exa-linux-x86_64-v0.10.1.zip
        sha256: a65a87bd545e969979ae9388f6333167f041a1f09fa9d60b32fd3072348ff6ce
        x-checker-data:
          type: anitya
          project-id: 16575
          stable-only: true
          url-template: https://github.com/ogham/exa/releases/download/v$version/exa-linux-x86_64-v$version.zip

  - name: lsd
    buildsystem: simple
    build-commands:
      - install -Dm755 lsd -t ${FLATPAK_DEST}/bin/
      - install -Dm644 autocomplete/lsd.bash-completion ${FLATPAK_DEST}/share/bash-completion/completions/lsd
      - install -Dm644 autocomplete/lsd.fish -t ${FLATPAK_DEST}/share/fish/vendor_completions.d/
      - install -Dm644 autocomplete/_lsd -t ${FLATPAK_DEST}/share/zsh/site-functions/
      - install -Dm644 lsd.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/Peltoche/lsd/releases/download/0.22.0/lsd-0.22.0-x86_64-unknown-linux-gnu.tar.gz
        sha256: 1d5ad5b09c8f5b974f96439725b150fb87e4587e27d57a1d8c4486a73629890c
        x-checker-data:
          type: anitya
          project-id: 20242
          stable-only: true
          url-template: https://github.com/Peltoche/lsd/releases/download/$version/lsd-$version-x86_64-unknown-linux-gnu.tar.gz

  - name: vifm
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/vifm/vifm-0.12.tar.bz2
        sha256: 33a9618f32b35b5b8c64483884f9ad09963ca8465b2935def79159028e27b2c0
        x-checker-data:
          type: html
          url: https://vifm.info/downloads.shtml
          version-pattern: vifm-([\d\.-]*).tar.bz2
          url-template: https://prdownloads.sourceforge.net/vifm/vifm-$version.tar.bz2

  - name: rmtrash
    buildsystem: simple
    build-commands:
      - install -Dm755 rmtrash rmdirtrash -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        url: https://github.com/PhrozenByte/rmtrash/archive/v1.14/rmtrash-1.14.tar.gz
        sha256: 119cf1a5e9c5ecadb95cfcc46999a5db6d55e0bb822f411c9a1b9c7d0cdf76b7
        x-checker-data:
          type: anitya
          project-id: 267500
          stable-only: true
          url-template: https://github.com/PhrozenByte/rmtrash/archive/v$version/rmtrash-$version.tar.gz
    modules:
      - name: trash-cli
        buildsystem: simple
        build-commands:
          - pip3 install --exists-action=i --no-index --find-links=file://$PWD --prefix=$FLATPAK_DEST trash-cli --no-build-isolation
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/36/d2/6415cda6cdd81ee0eb07b357e96a03c96a78af324d7eb2c52ff51d080210/trash-cli-0.22.4.16.tar.gz
            sha256: ec60ff1a038402f4b1e7360b32707bc36dc275fa32e512bb81274c0375d20003
            x-checker-data:
              type: pypi
              name: trash-cli
          - type: file
            url: https://files.pythonhosted.org/packages/d6/de/0999ea2562b96d7165812606b18f7169307b60cd378bc29cf3673322c7e9/psutil-5.9.1.tar.gz
            sha256: 57f1819b5d9e95cdfb0c881a8a5b7d542ed0b7c522d575706a80bedc848c8954
            x-checker-data:
              type: pypi
              name: psutil

  - name: neovide
    buildsystem: simple
    build-commands:
      - install -Dm755 neovide -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 3
        url: https://github.com/neovide/neovide/releases/download/0.9.0/neovide.tar.gz
        sha256: 684cbcaeb2e67f1d95822ef80e03e1475395d537f2032f47b8202fe48c428b08
        x-checker-data:
          type: json
          url: https://api.github.com/repos/neovide/neovide/releases/latest
          version-query: .tag_name
          url-query: '"https://github.com/neovide/neovide/releases/download/" + $version + "/neovide.tar.gz"'

  - name: pyenv
    buildsystem: simple
    build-commands:
      - install -dm755 ${FLATPAK_DEST}/share/pyenv
      - cp -a libexec plugins pyenv.d ${FLATPAK_DEST}/share/pyenv/
      - ln -sr ${FLATPAK_DEST}/share/pyenv/{libexec/pyenv,plugins/python-build/bin/*} -t ${FLATPAK_DEST}/bin/
      - install -Dm644 completions/pyenv.bash ${FLATPAK_DEST}/share/bash-completion/completions/pyenv
      - install -Dm644 completions/pyenv.fish -t ${FLATPAK_DEST}/share/fish/vendor_completions.d/
      - install -Dm644 completions/pyenv.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_pyenv
      - install -Dm644 man/man1/pyenv.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/pyenv/pyenv/archive/v2.3.2/pyenv-2.3.2.tar.gz
        sha256: 150ac8f7161c00e8e613bf5e273306f674b60037e3dace9c6bb7611dceb17144
        x-checker-data:
          type: json
          url: https://api.github.com/repos/pyenv/pyenv/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/pyenv/pyenv/archive/v" + $version + "/pyenv-" + $version + ".tar.gz"'
    cleanup:
      - /share/pyenv/pyenv.d/install
      - /share/pyenv/plugins/python-build/scripts
      - /share/pyenv/plugins/python-build/test
      - .gitignore
      - LICENSE
      - README.md
      - install.sh

  - name: fish
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=None
      - -Wno-dev
    sources:
      - type: archive
        url: https://github.com/fish-shell/fish-shell/releases/download/3.5.0/fish-3.5.0.tar.xz
        sha256: 291e4ec7c6c3fea54dc1aed057ce3d42b356fa6f70865627b2c7dfcecaefd210
        x-checker-data:
          type: anitya
          project-id: 815
          stable-only: true
          url-template: https://github.com/fish-shell/fish-shell/releases/download/$version/fish-$version.tar.xz

  - name: zsh
    build-options:
      cflags: -I/usr/lib/x86_64-linux-gnu/include
    config-opts:
      - --docdir=${FLATPAK_DEST}/share/doc/zsh
      - --htmldir=${FLATPAK_DEST}/share/doc/zsh/html
      - --enable-etcdir=${FLATPAK_DEST}/etc/zsh
      - --enable-zshenv=${FLATPAK_DEST}/etc/zsh/zshenv
      - --enable-zlogin=${FLATPAK_DEST}/etc/zsh/zlogin
      - --enable-zlogout=${FLATPAK_DEST}/etc/zsh/zlogout
      - --enable-zprofile=${FLATPAK_DEST}/etc/zsh/zprofile
      - --enable-zshrc=${FLATPAK_DEST}/etc/zsh/zshrc
      - --enable-maildir-support
      - --enable-multibyte
      - --enable-function-subdirs
      - --enable-fndir=${FLATPAK_DEST}/share/zsh/functions
      - --enable-scriptdir=${FLATPAK_DEST}/share/zsh/scripts
      - --with-tcsetpgrp
      - --enable-pcre
      - --enable-cap
      - --enable-zsh-secure-free
    post-install:
     # unneeded filesystem (mv) operations on ${FLATPAK_DEST}/bin/zsh breaks rofiles, overwriting the file fix this
      - install -Dm755 ${FLATPAK_DEST}/bin/zsh{-*,}
    sources:
      - type: archive
        url: https://www.zsh.org/pub/zsh-5.9.tar.xz
        sha256: 9b8d1ecedd5b5e81fbf1918e876752a7dd948e05c1a0dba10ab863842d45acd5
        x-checker-data:
          type: anitya
          project-id: 5307
          stable-only: true
          url-template: https://www.zsh.org/pub/zsh-$version.tar.xz

  - name: termite
    buildsystem: meson
    config-opts:
      - --libexec=lib
    sources:
      - type: archive
        url: https://github.com/aperezdc/termite/releases/download/v16.4/termite-16.4.tar.xz
        sha256: e9a2105ca9310b616647cb63a0d0c8be7dbf003fd0ca68c5e4c64ed57a0b20ad
        x-checker-data:
          type: anitya
          project-id: 11226
          stable-only: true
          url-template: https://github.com/aperezdc/termite/releases/download/v$version/termite-$version.tar.xz
    cleanup:
      - /lib/systemd

  - name: foot
    buildsystem: meson
    sources:
      - type: archive
        url: https://codeberg.org/dnkl/foot/archive/1.12.1.tar.gz
        sha256: 14e307ac89454b682bb9f1bc644043779f4462df656034fcc4c1e72b18fbffdd
        x-checker-data:
          type: anitya
          project-id: 141611
          stable-only: true
          url-template: https://codeberg.org/dnkl/foot/archive/$version.tar.gz
    modules:
      - name: tllist
        buildsystem: meson
        sources:
          - type: archive
            url: https://codeberg.org/dnkl/tllist/archive/1.0.5.tar.gz
            sha256: b0f32c9b2c2015c8d8dd068fd4e8b586aa91ca1670badc274ec962559ee0aadd
            x-checker-data:
              type: anitya
              project-id: 141661
              stable-only: true
              url-template: https://codeberg.org/dnkl/tllist/archive/$version.tar.gz
        cleanup:
          - '*'
      - name: fcft
        buildsystem: meson
        sources:
          - type: archive
            url: https://codeberg.org/dnkl/fcft/archive/3.1.2.tar.gz
            sha256: f571afe693d3fa11fe36e97c7a2ecbbf9313755ee31c1ec3dcc648796b8e6db0
            x-checker-data:
              type: anitya
              project-id: 143240
              stable-only: true
              url-template: https://codeberg.org/dnkl/fcft/archive/$version.tar.gz

  - name: terminfo-db
    config-opts:
      - --bindir=/var/bin
      - --includedir=/var/include
      - --libdir=/var/lib
      - --enable-db-install
      - --without-ada
      - --without-curses-h
      - --without-cxx
      - --without-cxx-binding
      - --without-debug
      - --without-manpages
      - --without-normal
      - --without-progs
      - --without-tests
    make-install-args:
      - tabsetdir=/var/share/tabset
    sources:
      - type: archive
        url: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz
        sha256: 97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059
        x-checker-data:
          type: anitya
          project-id: 234776
          stable-only: true
          url-template: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$version.tar.gz

  - name: github-cli
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/gh -t ${FLATPAK_DEST}/bin/
      - install -Dm755 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - bin/gh completion -s bash | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/bash-completion/completions/gh
      - bin/gh completion -s fish | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/fish/vendor_completions.d/gh.fish
      - bin/gh completion -s zsh | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/zsh/site-functions/_gh
    sources:
      - type: archive
        url: https://github.com/cli/cli/releases/download/v2.14.1/gh_2.14.1_linux_amd64.tar.gz
        sha256: 21539943893f2edbefc5bf7bcdd5c1060038ef9e0b052a68d52dce2f55f9818e
        x-checker-data:
          type: anitya
          project-id: 135615
          stable-only: true
          url-template: https://github.com/cli/cli/releases/download/v$version/gh_${version}_linux_amd64.tar.gz

  - name: github-hub
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/hub -t ${FLATPAK_DEST}/bin/
      - install -Dm755 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 etc/hub.bash_completion.sh ${FLATPAK_DEST}/share/bash-completion/completions/hub
      - install -Dm644 etc/hub.fish_completion ${FLATPAK_DEST}/share/fish/vendor_completions.d/hub.fish
      - install -Dm644 etc/hub.zsh_completion ${FLATPAK_DEST}/share/zsh/site-functions/_hub
      - cp -a share/vim ${FLATPAK_DEST}/share/
    sources:
      - type: archive
        url: https://github.com/github/hub/releases/download/v2.14.2/hub-linux-amd64-2.14.2.tgz
        sha256: 74d95fdfb3c78c8af4e2025b04b916ad905ab99a361778500d58269847c7922d
        x-checker-data:
          type: anitya
          project-id: 5368
          stable-only: true
          url-template: https://github.com/github/hub/releases/download/v$version/hub-linux-amd64-$version.tgz

  - name: gitlab-cli
    buildsystem: simple
    build-commands:
      - bsdtar -Oxf glab.deb 'data.tar*' | bsdtar -xf - --strip-components=2
      - install -Dm755 bin/glab -t ${FLATPAK_DEST}/bin/
      - install -Dm755 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - bin/glab completion -s bash | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/bash-completion/completions/glab
      - bin/glab completion -s fish | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/fish/vendor_completions.d/glab.fish
      - bin/glab completion -s zsh | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/zsh/site-functions/_glab
    sources:
      - type: file
        dest-filename: glab.deb
        url: https://github.com/profclems/glab/releases/download/v1.22.0/glab_1.22.0_Linux_x86_64.deb
        sha256: 5761f235ee5ef358dabcb8a5d86013572eb504cc43237b84c258114ab3fd7c27
        x-checker-data:
          type: anitya
          project-id: 127208
          stable-only: true
          url-template: https://github.com/profclems/glab/releases/download/v$version/glab_${version}_Linux_x86_64.deb

  - name: gitlab-release-cli
    buildsystem: simple
    build-commands:
      - install -Dm755 release-cli -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: release-cli
        url: https://gitlab.com/gitlab-org/release-cli/-/releases/v0.11.0/downloads/bin/release-cli-linux-amd64
        sha256: c3bc1c23c3c91267c550e8ab8b53f6b699ec914046434dff3857b4d317f179e1
        x-checker-data:
          type: anitya
          project-id: 267525
          stable-only: true
          url-template: https://gitlab.com/gitlab-org/release-cli/-/releases/v$version/downloads/bin/release-cli-linux-amd64

  - name: gitea-tea
    buildsystem: simple
    build-commands:
      - install -Dm755 tea -t ${FLATPAK_DEST}/bin/
      - install -Dm644 contrib/autocomplete.sh ${FLATPAK_DEST}/share/bash-completion/completions/tea
      - install -Dm644 contrib/autocomplete.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_tea
    sources:
      - type: file
        dest-filename: tea
        url: https://gitea.com/gitea/tea/releases/download/v0.8.0/tea-0.8.0-linux-amd64
        sha256: 8bc99e0532548365f3d86a5ec319772121a844d54a01cb51cddb030d05f27a0c
        x-checker-data:
          type: json
          url: https://gitea.com/api/v1/repos/gitea/tea/releases
          version-query: first(.[].tag_name | sub("^v"; ""))
          url-query: '"https://gitea.com/gitea/tea/releases/download/v" + $version + "/tea-" + $version + "-linux-amd64"'
      - type: archive
        url: https://gitea.com/gitea/tea/archive/v0.8.0.tar.gz
        sha256: 6c73c0a7b66cdfd1e5a302257d54df06a3a41eb9bdbfeb547966db431ae23b23
        x-checker-data:
          type: json
          url: https://gitea.com/api/v1/repos/gitea/tea/releases
          version-query: first(.[].tag_name | sub("^v"; ""))
          url-query: '"https://gitea.com/gitea/tea/archive/v" + $version + ".tar.gz"'

  - name: fzf
    buildsystem: simple
    build-commands:
      - install -Dm755 fzf bin/fzf-tmux -t ${FLATPAK_DEST}/bin/
      - install -Dm755 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 shell/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/fzf
     #- install -Dm644 shell/completion.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/fzf.fish
      - install -Dm644 shell/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_fzf
      - install -Dm644 shell/key-bindings.{bash,zsh} -t ${FLATPAK_DEST}/share/fzf/
      - install -Dm644 shell/key-bindings.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/fzf_key_bindings.fish
      - install -Dm644 doc/fzf.txt -t ${FLATPAK_DEST}/share/vim/vimfiles/doc/
      - install -Dm644 plugin/fzf.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/plugin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/junegunn/fzf/releases/download/0.30.0/fzf-0.30.0-linux_amd64.tar.gz
        sha256: 53b136e0566a1b3ab57c28dffadb3d0392ad0968a714e65862cf4497152674e5
        x-checker-data:
          type: anitya
          project-id: 15856
          stable-only: true
          url-template: https://github.com/junegunn/fzf/releases/download/$version/fzf-$version-linux_amd64.tar.gz
      - type: archive
        url: https://github.com/junegunn/fzf/archive/0.30.0/fzf-0.30.0.tar.gz
        sha256: a3428f510b7136e39104a002f19b2e563090496cb5205fa2e4c5967d34a20124
        x-checker-data:
          type: anitya
          project-id: 15856
          stable-only: true
          url-template: https://github.com/junegunn/fzf/archive/$version/fzf-$version.tar.gz

  - name: bash-completion
    sources:
      - type: archive
        url: https://github.com/scop/bash-completion/releases/download/2.11/bash-completion-2.11.tar.xz
        sha256: 73a8894bad94dee83ab468fa09f628daffd567e8bef1a24277f1e9a0daf911ac
        x-checker-data:
          type: anitya
          project-id: 5667
          stable-only: true
          url-template: https://github.com/scop/bash-completion/releases/download/$version/bash-completion-$version.tar.xz

  - name: bash-complete-alias
    buildsystem: simple
    build-commands:
      - install -Dm644 complete_alias -t ${FLATPAK_DEST}/share/bash-complete-alias/
    sources:
      - type: archive
        url: https://github.com/cykerway/complete-alias/archive/1.18.0/complete-alias-1.18.0.tar.gz
        sha256: c34b85c2729650415d97280afeeed6aa29a9e318a8a39061722493cacb927445
        x-checker-data:
          type: anitya
          project-id: 267535
          stable-only: true
          url-template: https://github.com/cykerway/complete-alias/archive/$version/complete-alias-$version.tar.gz

  - name: kakoune
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
      - libexecdir=${FLATPAK_DEST}/lib/kak
    sources:
      - type: archive
        url: https://github.com/mawww/kakoune/releases/download/v2021.11.08/kakoune-2021.11.08.tar.bz2
        sha256: aa30889d9da11331a243a8f40fe4f6a8619321b19217debac8f565e06eddb5f4
        x-checker-data:
          type: anitya
          project-id: 17726
          stable-only: true
          url-template: https://github.com/mawww/kakoune/releases/download/v$version/kakoune-$version.tar.bz2

  - name: kak-lsp
    buildsystem: simple
    build-commands:
      - install -Dm755 kak-lsp -t ${FLATPAK_DEST}/bin/
      - install -Dm644 kak-lsp.toml -t ${FLATPAK_DEST}/share/kak-lsp/examples/
      - install -Dm644 rc/lsp.kak -t ${FLATPAK_DEST}/share/kak-lsp/rc/
    sources:
      - type: archive
        url: https://github.com/kak-lsp/kak-lsp/archive/v12.2.1/kak-lsp-12.2.1.tar.gz
        sha256: 3769883060ff837a6eb8220943290e32fcafa9fe86a9c2231b1cdb391d35be66
        x-checker-data:
          type: anitya
          project-id: 267541
          stable-only: true
          url-template: https://github.com/kak-lsp/kak-lsp/archive/v$version/kak-lsp-$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/kak-lsp/kak-lsp/releases/download/v12.2.1/kak-lsp-v12.2.1-x86_64-unknown-linux-musl.tar.gz
        sha256: 967ebf39a4942765c6a36dc4ca411603a173d70b4d69be80db91eab306e9a0ac
        x-checker-data:
          type: anitya
          project-id: 267541
          stable-only: true
          url-template: https://github.com/kak-lsp/kak-lsp/releases/download/v$version/kak-lsp-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: fzy
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/jhawthorn/fzy/archive/1.0/fzy-1.0.tar.gz
        sha256: 80257fd74579e13438b05edf50dcdc8cf0cdb1870b4a2bc5967bd1fdbed1facf
        x-checker-data:
          type: anitya
          project-id: 267539
          stable-only: true
          url-template: https://github.com/jhawthorn/fzy/archive/$version/fzy-$version.tar.gz

  - name: skim
    buildsystem: simple
    build-commands:
      - install -Dm755 sk bin/sk-tmux -t ${FLATPAK_DEST}/bin/
      - install -Dm755 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 shell/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/sk
      - install -Dm644 shell/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_sk
      - install -Dm644 shell/key-bindings.{bash,zsh} -t ${FLATPAK_DEST}/share/skim/
      - install -Dm644 shell/key-bindings.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/skim_key_bindings.fish
      - install -Dm644 plugin/skim.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/plugin/
    sources:
      - type: archive
        url: https://github.com/lotabout/skim/archive/v0.9.4/skim-0.9.4.tar.gz
        sha256: 5ec639c34c7657be4f7f990e9ad0d8d0a7a979eba68daa7c100126ce06702a1b
        x-checker-data:
          type: anitya
          project-id: 16131
          stable-only: true
          url-template: https://github.com/lotabout/skim/archive/v$version/skim-$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/lotabout/skim/releases/download/v0.9.4/skim-v0.9.4-x86_64-unknown-linux-musl.tar.gz
        sha256: a73c94622d9aaab18f9a03a9bf7af0ca2f7059280ea3df24c09c1e7e0b359c32
        x-checker-data:
          type: anitya
          project-id: 16131
          stable-only: true
          url-template: https://github.com/lotabout/skim/releases/download/v$version/skim-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: ugrep
    sources:
      - type: archive
        url: https://github.com/Genivia/ugrep/archive/v3.8.3/ugrep-3.8.3.tar.gz
        sha256: deb7e143ee07019fdaa98a4529596d965185542a195855c1bfb6779fb8dd5e55
        x-checker-data:
          type: anitya
          project-id: 187554
          stable-only: true
          url-template: https://github.com/Genivia/ugrep/archive/v$version/ugrep-$version.tar.gz

  - name: broot
    buildsystem: simple
    build-commands:
      - install -Dm755 x86_64-unknown-linux-gnu/broot -t ${FLATPAK_DEST}/bin/
      - install -Dm755 broot.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 completion/br.bash ${FLATPAK_DEST}/share/bash-completion/completions/br
      - install -Dm644 completion/br.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/br.fish
     #- install -Dm644 completion/br.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_br
      - install -Dm644 resources/vscode.ttf -t ${FLATPAK_DEST}/share/fonts/vscode/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/Canop/broot/releases/download/v1.14.2/broot_1.14.2.zip
        sha256: 4e9bc7d5bc793deec387700c2258339b51e2dd499b41c010f8e0027e6a5d854c
        x-checker-data:
          type: anitya
          project-id: 141357
          stable-only: true
          url-template: https://github.com/Canop/broot/releases/download/v$version/broot_$version.zip

  - name: packaging
    buildsystem: simple
    build-commands:
      - install -dm755 ${FLATPAK_DEST}/lib
      - ln -s python$(python -c 'import sys; print("%s.%s" %sys.version_info[0:2])') ${FLATPAK_DEST}/lib/python
      - install -Dm755 enable{,-bash,-sdks}.sh -t ${FLATPAK_DEST}/
      - install -Dm755 enable-development-environment -t ${FLATPAK_DEST}/bin/
      - install -Dm644 bash.bashrc inputrc -t ${FLATPAK_DEST}/etc/
      - install -Dm755 ssh -t ${FLATPAK_DEST}/bin/
      - ln -s nvim ${FLATPAK_DEST}/bin/vim
    sources:
      - type: script
        dest-filename: enable.sh
        commands:
          - |
            if [ -z "$FLATPAK_DEVELOPMENT_ENVIRONMENT" ]; then
              export FLATPAK_DEVELOPMENT_ENVIRONMENT=1
              SDKPATH=/usr/lib/sdk/devenv
              export PATH=${SDKPATH}/bin:$PATH
              export XDG_DATA_DIRS=$XDG_DATA_DIRS:${SDKPATH}/share
              if [ -z "$LD_LIBRARY_PATH" ]; then
                export LD_LIBRARY_PATH=${SDKPATH}/lib
              else
                export LD_LIBRARY_PATH+=:${SDKPATH}/lib
              fi
              if [ -z "$PYTHONPATH" ]; then
                export PYTHONPATH=${SDKPATH}/lib/python/site-packages
              else
                export PYTHONPATH+=:${SDKPATH}/lib/python/site-packages
              fi
              if [[ ":$TERMINFO_DIRS:" != *":${SDKPATH}/share/terminfo:"* ]]; then
                if [[ "$TERMINFO_DIRS" != *":" ]] && [ -n "$TERMINFO_DIRS" ]; then
                  export TERMINFO_DIRS+=":${SDKPATH}/share/terminfo:"
                else
                  export TERMINFO_DIRS+="${SDKPATH}/share/terminfo:"
                fi
              fi
            fi
      - type: script
        dest-filename: enable-bash.sh
        commands:
          - source /usr/lib/sdk/devenv/enable.sh
          - exec /usr/bin/bash -i --rc-file ~/projects/flatpak-dotuser/dots/bash/.bashrc
      - type: script
        dest-filename: enable-development-environment
        commands:
          - |
            if [ -z "$FLATPAK_DEVELOPMENT_ENVIRONMENT" ]; then
              source /usr/lib/sdk/devenv/enable.sh
              exec bash -i
            fi
      - type: script
        dest-filename: ssh
        commands:
          - |
            /usr/bin/ssh \
            -F /home/${USER}/.config/ssh/config \
            -o "UserKnownHostsFile /home/${USER}/.config/ssh/known_hosts" \
            "$@"
      - type: file
        path: enable-sdks.sh
      - type: file
        path: bash.bashrc
      - type: file
        path: inputrc
