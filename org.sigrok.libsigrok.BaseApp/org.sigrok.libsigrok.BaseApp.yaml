# TODO: add module sigrok-firmware-fx2lafw? https://www.kernel.org/doc/html/latest/driver-api/firmware/fw_search_path.html
# TODO: enable java bindings?
app-id: org.sigrok.libsigrok.BaseApp
runtime: org.kde.Platform
runtime-version: 5.15-21.08
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk
modules:
  - name: libsigrok
    config-opts:
      - --enable-ruby=yes
#   build-options:
#     env:
#       - JAVA_HOME=/usr/lib/sdk/openjdk/jvm/openjdk-14
#       - PATH=/usr/bin:/app/bin:/usr/lib/sdk/openjdk/bin
    post-install:
      - install -Dm644 contrib/6*-libsigrok*.rules -t /app/docs/udev_rules/
    sources:
      - type: git
        url: https://github.com/sigrokproject/libsigrok.git
        branch: master
        commit: e847645b7be832c1d62d1ad2312e3a3d4de467ce
# TODO: enable back after a new major release
#     - type: archive
#       url: https://sigrok.org/download/source/libsigrok/libsigrok-0.5.2.tar.gz
#       sha256: 4d341f90b6220d3e8cb251dacf726c41165285612248f2c52d15df4590a1ce3c
#       commit: 2111d1574b7bc715bc60ca5626f126369553f3f8
#       x-checker-data:
#         type: anitya
#         project-id: 21369
#         stable-only: true
#         url-template: https://sigrok.org/download/source/libsigrok/libsigrok-$version.tar.gz
#     - type: patch
#       path: libsigrok-swig4_java_bindings.patch
    modules:
      - ../shared-modules/gtkmm3/glibmm.json
      - ../shared-modules/libftdi/libftdi.json
      - ../shared-modules/libieee1284/libieee1284.json
      - ../shared-modules/libserialport/libserialport.json
      - ../shared-modules/libzip/libzip.json
      - ../shared-modules/python-gobject/python-gobject.json
      - ../shared-modules/python-numpy/python-numpy.json
      - ../shared-modules/ruby/ruby.json
  - name: libsigrokdecode
    sources:
# TODO: enable back after a new major release
#     - type: archive
#       url: https://sigrok.org/download/source/libsigrokdecode/libsigrokdecode-0.5.3.tar.gz
#       sha256: c50814aa6743cd8c4e88c84a0cdd8889d883c3be122289be90c63d7d67883fc0
#       x-checker-data:
#         type: anitya
#         project-id: 9552
#         stable-only: true
#         url-template: https://sigrok.org/download/source/libsigrokdecode/libsigrokdecode-$verion.tar.gz
      - type: git
        url: https://github.com/sigrokproject/libsigrokdecode.git
        branch: master
        commit: 02aa01ad5f05f2730309200abda0ac75d3721e1d
      - type: shell
        commands:
          - autoreconf --force --install
# TODO: split out to a separate app?
  - name: sigrok-cli
    sources:
      - type: archive
        url: https://github.com/sigrokproject/sigrok-cli/archive/sigrok-cli-0.7.2.tar.gz
        sha256: cf3594623994f37dd7aa99d1804fd41f26fefb2030be451375484d7435c83a58
        x-checker-data:
          type: anitya
          project-id: 9550
          stable-only: true
          url-template: https://github.com/sigrokproject/sigrok-cli/archive/sigrok-cli-$version.tar.gz
