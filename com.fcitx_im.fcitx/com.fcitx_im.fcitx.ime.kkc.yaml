app-id: com.fcitx_im.fcitx.ime.kkc
runtime: com.fcitx_im.fcitx
sdk: org.gnome.Sdk//3.36
build-extension: true
separate-locales: false
build-options:
  prefix: /app/ime/kkc
  libdir: /app/ime/kkc/lib
  ldflags: -L/app/ime/kkc/lib
  prepend-pkg-config-path: /app/ime/kkc/lib/pkgconfig
  prepend-ld-library-path: /app/ime/kkc/lib
  prepend-path: /app/ime/kkc/bin
  cflags: -I/app/ime/kkc/include
  cxxflags: -I/app/ime/kkc/include
modules:
  - name: fcitx-kkc
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DENABLE_QT=Off
    build-commands:
      - sed -i 's#/app/include#/app/ime/include#g' src/cmake_install.cmake
    post-install:
      - ./rename_icons
    sources:
      - type: archive
        url: https://download.fcitx-im.org/fcitx-kkc/fcitx-kkc-0.1.4.tar.xz
        sha256: f19b447e2faac2b1ca71864688a6fc73deee68d824d399a28aea230b2ec25c17
      - type: file
        path: rename_icons
      - type: shell
        commands:
          - sed -i 's/FCITX4_PREFIX/CMAKE_INSTALL_PREFIX/g' src/CMakeLists.txt
    modules:
      - name: libkkc
        build-options:
          env:
            - PYTHONPATH=/app/ime/kkc/lib/python3.7/site-packages
        sources:
          - type: git
            url: https://github.com/ueno/libkkc
            commit: b2e5a152980ee627c39ca8a49082e6df7694b8fc
        modules:
          - name: marisa
            build-commands:
              - make -C bindings swig-python
              - cd bindings/python && python3 setup.py build_ext
                --include-dirs=../../include
                --library-dirs=../../lib/marisa/.libs
              - cd bindings/python && python3 setup.py build
            post-install:
              - cd bindings/python && python3 setup.py install --prefix=${FLATPAK_DEST}
            sources:
              - type: archive
                url: https://github.com/s-yata/marisa-trie/archive/v0.2.6.tar.gz
                sha256: 1063a27c789e75afa2ee6f1716cc6a5486631dcfcb7f4d56d6485d2462e566de
              - type: shell
                commands:
                  - autoreconf -i
            modules:
              - name: swig
                sources:
                  - type: archive
                    url: https://downloads.sourceforge.net/swig/swig-4.0.2.tar.gz
                    sha256: d53be9730d8d58a16bf0cbd1f8ac0c0c3e1090573168bfa151b01eb47fa906fc
      - name: libkkc-data
        build-options:
          env:
            - PYTHONPATH=/app/ime/kkc/lib/python3.7/site-packages
        sources:
          - type: file
            url: https://github.com/ueno/libkkc/releases/download/v0.3.5/libkkc-data-0.2.7.tar.xz
            sha256: 9e678755a030043da68e37a4049aa296c296869ff1fb9e6c70026b2541595b99
          - type: shell
            commands:
              - tar -xf libkkc-data-0.2.7.tar.xz --strip=4 libkkc-data-0.2.7/data/models/text3/data.arpa
              - kkc-package-data data.arpa
              - tar -xf libkkc-data-0.3.5.tar.xz --strip=1
      - name: skk-jisyo
        buildsystem: simple
        build-commands:
          - gunzip *.gz
          - install -d ${FLATPAK_DEST}/share/skk
          - install -m644 SKK-JISYO.* -t ${FLATPAK_DEST}/share/skk/
        sources:
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.L.gz
            sha256: 59080c482f5f452c953f834d7ac4f238f6d21070e4f4454d13e98872119e8cf4
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.ML.gz
            sha256: 47105dc34df553cc587d431f035bac6d1e156bf23b6b47af63b9245817e9cf5f
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.S.gz
            sha256: 97b7d5adec80f105a158ddf2106d9c8fed678bc860e4a38a8c47ca2b04bfb619
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.JIS2.gz
            sha256: ef8cb03085e13e251e7216c2b1bfaa39f6ac67c0588f1d7944742bf82ec11754
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.JIS2004.gz
            sha256: 644e1fe56181f45fa8da3c9fb65a7f337434af7d8e002778ebb99a6117fdd027
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.JIS3_4.gz
            sha256: 77db2f8010142e2c9ba87b05a1b1409bde74ef61bd5961e5bfc4896670401792
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.assoc.gz
            sha256: eb24eb46414df1a569fa01500d780c1aa02c60dc9bdb27bdd4652665775fffc4
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.china_taiwan.gz
            sha256: 93c31f30ba3f32c47f00e16c4f9eec6cdc6b570f5e57aa2efc23060eb72f5b59
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.fullname.gz
            sha256: b70e1b2ec74a6f2355397927c6ba5761de383d0bf6bf854e5baa6f5ee36e2d1a
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.geo.gz
            sha256: 415789525e2e3899db1f8b2838508ca1fae553530a8251cf507bfe8c5a8823c8
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.itaiji.gz
            sha256: 9d57cd74e3e87b29b45c1b2bcc9159d3aabe02f898c7153cc5e4669d3d3bbac6
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.itaiji.JIS3_4.gz
            sha256: 5b6c341cd75ad94194f81458b4d096ce9884698c3e71199f3aff39eb3d1bb90d
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.jinmei.gz
            sha256: cb0a01514f5371b6c607fc4e8f9cac7e945519560ad749d021ca1269fdda993a
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.law.gz
            sha256: 1f563b9d30d539b9ae3ca0fdf61947b5c03f9b2c7771d31a22c378fe56977a66
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.lisp.gz
            sha256: e6c88617f7bfe58278da8ec3951a585d55e2210ae5437bbad1a666f115157893
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.mazegaki.gz
            sha256: a4f910065b050d22797cd9e528b4a411e09ad6a9577651ea097edc759ae2e226
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.okinawa.gz
            sha256: 851b076be6ca24bea975f986f7386bada33128014e024ae7adfef0bd2131cba3
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.propernoun.gz
            sha256: 00d951a4c1f4ac9441e4b10c3f4a15dfcc8b1e4b54d21a75f0be575fdedff6a6
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.pubdic+.gz
            sha256: 4634b29252e0c7ee199447cf2acfea2cbec13a4f1fcc9d3876feb3a72e7590e4
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.requested.gz
            sha256: dfa8b678c1bbc8edb3df768d21359efd4e8c3bf6bd3a27987b39966f7f6e0408
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.station.gz
            sha256: 15b169e489a014969d701f4de93ee21867a6d71a6df5381990e4631c4fb778c1
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.wrong.gz
            sha256: 1b37290324cfc264ed88c87f7dfdc11021e0b55ecd4bd26c0d76c8aa48fe813d
          - type: file
            url: http://openlab.ring.gr.jp/skk/dic/SKK-JISYO.wrong.annotated.gz
            sha256: ad57ab4608b5aca8377a2c2c43980c196eb2d514f9dcfdc1fd3f880d22dab33c
        #modules:
        #  - name: skktools
